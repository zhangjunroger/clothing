<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>å®åŠ›ç®¡ç†</title>
  <script>
    const currentUser = <%- JSON.stringify(user || {}) %>; // åœ¨é¡µé¢é¡¶éƒ¨å®šä¹‰    
  </script>
  <!-- å¼•å…¥Tailwind CSSï¼ˆä»…å¼€å‘ç¯å¢ƒç¤ºä¾‹ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- 1. å¼•å…¥æŸæ¬¾è‰ºæœ¯å­—ä½“ï¼ˆç¤ºä¾‹ï¼šAmatic SCï¼‰ -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&display=swap" />
  <!-- å¼•å…¥ Font Awesome å›¾æ ‡ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- PDFç”Ÿæˆåº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

  <!-- Excelç”Ÿæˆåº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<style>
  /* ==================== å…¨å±€æ ·å¼é‡ç½®å’ŒåŸºç¡€é…ç½® ==================== */
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }
  
  /* èƒŒæ™¯å›¾ç‰‡æ ·å¼ */
  body {
      background-image: url('/images/background.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-attachment: fixed;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft YaHei", sans-serif;
      color: #2d3748;
      line-height: 1.6;
  }
  
  /* ==================== è‰ºæœ¯å­—ä½“é…ç½® ==================== */
  .fancy-font {
      font-family: 'Amatic SC', cursive;
  }
  
  /* ==================== ä¸»å®¹å™¨æ ·å¼ ==================== */
  .container {
      width: 95%;
      max-width: 1800px;
      margin: 20px auto;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
  }
  
  .container:hover {
      transform: translateY(-3px);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
  }
  
  /* ==================== é¡µé¢ä¸»æ ‡é¢˜æ ·å¼ - è¶…å¤§æ°”åŠ¿ ==================== */
        /* é¡µé¢æ ‡é¢˜æ ·å¼ */
        .page-title {
            text-align: center;
            color: white;
            font-size: clamp(1.8rem, 4vw, 3rem);
            font-weight: 700;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            background: rgba(246, 3, 3, 0.6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

  h1 {
      text-align: center;
      font-size: clamp(4rem, 8vw, 6rem);
      font-weight: 900;
      letter-spacing: 4px;
      margin-bottom: 3rem;
      line-height: 1.1;
      color: transparent;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 
          0 8px 16px rgba(0, 0, 0, 0.3),
          0 4px 8px rgba(102, 126, 234, 0.4),
          4px 4px 0px rgba(102, 126, 234, 0.6),
          8px 8px 0px rgba(118, 75, 162, 0.4);
      position: relative;
      font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
      animation: titleGlow 3s ease-in-out infinite alternate;
  }

  h11 {
      text-align: center;
      font-weight: 900;
      letter-spacing: 4px;
      margin-bottom: 3rem;
      line-height: 1.1;
      color: #000;
      position: relative;
      font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
  }

  
  @keyframes titleGlow {
      0% {
          filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
      }
      100% {
          filter: drop-shadow(0 0 20px rgba(118, 75, 162, 0.8));
      }
  }
  
  h1::after {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 8px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      border-radius: 4px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
  }
  
  h1::before {
      content: '';
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 4px;
      background: linear-gradient(90deg, #f093fb 0%, #764ba2 50%, #667eea 100%);
      border-radius: 2px;
      box-shadow: 0 2px 10px rgba(240, 147, 251, 0.4);
  }
  
  /* ==================== åŒºåŸŸæ ‡é¢˜æ ·å¼ ==================== */
  h2 {
      color: #2d3748;
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      position: relative;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  
  h2::before {
      content: 'ğŸ“Š';
      font-size: 1.5rem;
      margin-right: 0.5rem;
  }
  
  /* ä¸åŒåŒºåŸŸçš„å›¾æ ‡ */
  section:first-of-type h2::before {
      content: 'ğŸ‘¥'; /* å®åŠ›ä¿¡æ¯åˆ—è¡¨ */
  }
  
  section:nth-of-type(2) h2::before {
      content: 'ğŸ“¤'; /* æ¨¡ç‰ˆä¸Šä¼  */
  }
  
  /* ==================== å¡ç‰‡å®¹å™¨åŸºç¡€æ ·å¼ ==================== */
  section {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(15px);
      padding: 0.1rem;
      margin-top: 0.5rem; 
      margin-bottom: 0.5rem;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.15);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
  }
  
  section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  }
  
  section:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.15);
  }
  
  /* ==================== æœç´¢è¡¨å•æ ·å¼ ==================== */
  .search-form, #searchForm {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 2rem;
      border-radius: 20px;
      margin-bottom: 0.1rem;
      border: 2px solid rgba(102, 126, 234, 0.2);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: end;
      position: relative;
  }
  
  .search-form::before, #searchForm::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px 20px 0 0;
  }
  
  .search-form input,
  .search-form select,
  #searchForm input,
  #searchForm select {
      flex: 1;
      min-width: 150px;
      height: 3rem;
      padding: 0.75rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 14px;
      background: #fff;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      font-family: inherit;
  }
  
  .search-form input:focus,
  .search-form select:focus,
  #searchForm input:focus,
  #searchForm select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
      transform: translateY(-2px);
  }
  
  .search-form input::placeholder {
      color: #a0aec0;
      font-style:normal;
  }
  
  /* ==================== æŒ‰é’®ç³»ç»Ÿæ ·å¼ ==================== */
  .button, .btn-change, .btn-delete, .btn-button {
      padding: 0.875rem 1.75rem;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      min-width: 130px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
  }

  .btn-change1, .btn-delete1 {
      padding: 0.2rem 0.2rem;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.2rem;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      min-width: 50px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
  }

  
  /* æŒ‰é’®å…‰æ³½æ•ˆæœ */
  .button::before,
  .btn-change::before,
  .btn-delete::before,
  .btn-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s;
  }
  
  .button:hover::before,
  .btn-change:hover::before,
  .btn-delete:hover::before,
  .btn-button:hover::before {
      left: 100%;
  }
  
  /* ä¸»è¦æŒ‰é’® - è“ç´«æ¸å˜ */
  .button, .btn-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
  }
  
  .button:hover, .btn-button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
  }
  
  .button:active, .btn-button:active {
      transform: translateY(-1px) scale(0.98);
  }
  
  /* æœç´¢æŒ‰é’® - é’è‰²æ¸å˜ */
  .btn-change {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
  }
  
  .btn-change:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 30px rgba(79, 172, 254, 0.5);
      background: linear-gradient(135deg, #3d8bfe 0%, #00d4fe 100%);
  }


  /* æœç´¢æŒ‰é’® - é’è‰²æ¸å˜ */
  .btn-change1 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
  }
  
  .btn-change1:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 30px rgba(79, 172, 254, 0.5);
      background: linear-gradient(135deg, #3d8bfe 0%, #00d4fe 100%);
  }  
  
  /* åˆ é™¤/é‡ç½®æŒ‰é’® - çº¢è‰²æ¸å˜ */
  .btn-delete {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
  }
  
  .btn-delete:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5);
      background: linear-gradient(135deg, #ff5252 0%, #e53e3e 100%);
  }


  /* åˆ é™¤/é‡ç½®æŒ‰é’® - çº¢è‰²æ¸å˜ */
  .btn-delete1 {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
  }
  
  .btn-delete1:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5);
      background: linear-gradient(135deg, #ff5252 0%, #e53e3e 100%);
  }  
  
  /* ==================== åˆ†é¡µæŒ‰é’®æ ·å¼ ==================== */
  #firstPage, #prevPage, #nextPage, #lastPage {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.875rem 1.5rem;
      margin: 0 0.5rem;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      font-size: 14px;
      min-width: 100px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
  }
  
  #firstPage:hover, #prevPage:hover, #nextPage:hover, #lastPage:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
  }
  
  #firstPage:disabled, #prevPage:disabled, #nextPage:disabled, #lastPage:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
      background: #94a3b8;
  }
  
  /* ==================== é¡µç ä¿¡æ¯æ ·å¼ ==================== */
  #pageInfo {
      padding: 0.875rem 2rem;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      border-radius: 25px;
      font-weight: 700;
      color: #667eea;
      border: 2px solid rgba(102, 126, 234, 0.3);
      margin: 0 1rem;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
/* ==================== å•é€‰æ¡†ç»„æ ·å¼ ==================== */  
.radio-group {  
    display: flex;  
    gap: 1.5rem;  
    align-items: center;
    justify-content: center;
    margin-top: 0.1rem; 
    margin-bottom: 0.1rem; 
    padding: 0.1rem;  
    background: rgba(102, 126, 234, 0.08);  
    border-radius: 15px;  
    border: 2px solid rgba(102, 126, 234, 0.2);  
}  

.radio-group label {  
    display: flex;  
    align-items: center;  
    gap: 0.1rem;  
    cursor: pointer;  
    font-weight: 600;  
    color: #4a5568;  
    padding: 0.75rem 1.25rem;  
    border-radius: 10px;  
    transition: all 0.3s ease;  
    background: rgba(255, 255, 255, 0.7);  
    border: 1px solid rgba(102, 126, 234, 0.2);  
}  

.radio-group label:hover {  
    background: rgba(102, 126, 234, 0.15);  
    transform: translateY(-2px);  
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);  
}  

input[type="radio"], input[type="checkbox"] {  
    width: 20px;  
    height: 20px;  
    accent-color: #667eea;  
    cursor: pointer;  
}  
  
  /* ==================== è¡¨æ ¼å®¹å™¨å’Œæ ·å¼ ==================== */
  .table-container {
      background: #fff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
      border: 2px solid rgba(102, 126, 234, 0.2);
      margin: 0rem 0;
      max-height: 1200px;
      overflow-y: auto;
      position: relative;
      padding: 0 0;
  }
  
  .table-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      z-index: 10;
  }
  
  .users-table {
      width: 100%;
      border-collapse: collapse;
      margin: 0;
      background: #fff;
      font-size: 13px;
      table-layout: fixed;
  }
  
  /* ==================== è¡¨å¤´æ ·å¼ - æ”¯æŒè‡ªåŠ¨æ¢è¡Œ ==================== */
  .users-table thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      position: sticky;
      top: 0;
      z-index: 10;
  }
  
.users-table th {  
  padding: 0.3rem 0.1rem; /* ç¨å¾®å¢åŠ ä¸Šä¸‹padding */  
  text-align: center;  
  font-weight: 700;  
  color: white;  
  border: none;  
  font-size: 14px;  
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);  
  white-space: normal !important;  
  word-break: break-all !important;  
  line-height: 1.1; /* ä»0.5æ”¹ä¸º1.1 */  
  min-height: 20px; /* ä»30pxå‡å°åˆ°20px */  
  height: 25px; /* å›ºå®šé«˜åº¦ */  
  vertical-align: middle;  
  position: relative;  
  text-transform: uppercase;  
  letter-spacing: 0.5px;  
} 
  
  .users-table th::after {
      content: '';
      position: absolute;
      right: 0;
      top: 10%;
      height: 80%;
      width: 1px;
      background: rgba(255, 255, 255, 0.3);
  }
  
  .users-table th:last-child::after {
      display: none;
  }
  
  
  /* ==================== è¡¨æ ¼æ•°æ®è¡Œæ ·å¼ ==================== */
  .users-table td {  
    padding: 0.1rem; /* å‡å°padding */  
    text-align: center;  
    border-bottom: 1px solid #e2e8f0;  
    background: #fff;  
    transition: all 0.3s ease;  
    vertical-align: middle;  
    font-size: 13px;  
    word-break: break-word;  
    hyphens: auto;  
    white-space: normal;  
    color: #4a5568;  
    font-weight: 500;  
    line-height: 1.1;  
    height: 30px; /* ä»15pxæ”¹ä¸º30pxï¼Œç»™æŒ‰é’®è¶³å¤Ÿç©ºé—´ */  
} 
  
  .users-table tr:nth-child(even) td {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }
  
  .users-table tbody tr:hover td {
      background: linear-gradient(135deg, #e8f2ff 0%, #dbeafe 100%);
      transform: scale(1.001);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
      color: #2d3748;
      font-weight: 600;
  }
  
  .users-table tbody tr {
      transition: all 0.3s ease;
      cursor: pointer;
  }
  
  /* æ“ä½œæŒ‰é’®åœ¨è¡¨æ ¼ä¸­çš„æ ·å¼ */
  .users-table td .btn-change1,  
.users-table td .btn-delete1 {  
    padding: 2px 6px; /* å¾ˆå°çš„å†…è¾¹è· */  
    font-size: 10px;  
    margin: 0 0px; /* åªæœ‰å·¦å³é—´è· */  
    min-width: 30px; /* å‡å°æœ€å°å®½åº¦ */  
    height: 20px; /* å›ºå®šæŒ‰é’®é«˜åº¦ */  
    line-height: 16px; /* æŒ‰é’®å†…æ–‡å­—è¡Œé«˜ */  
    border-radius: 4px;  
    border: none;  
    display: inline-block;  
    vertical-align: middle;  
}
  
/* åŒ…å«æŒ‰é’®çš„å•å…ƒæ ¼ - å…³é”®è®¾ç½® */  
/* æ“ä½œåˆ—å•ç‹¬è®¾ç½® */  
.users-table td:last-child {  
    padding: 2px; /* æ“ä½œåˆ—æ›´å°çš„å†…è¾¹è· */  
    height: 30px;  
    white-space: nowrap;  
}


  /* ==================== æ¨¡æ€çª—å£æ ·å¼ ==================== */
  .modal-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(15px);
      z-index: 999;
      animation: fadeIn 0.3s ease-out;
  }
  
  .modal-backdrop.active {
      display: block;
  }
  
  .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      width: 90%;
      max-width: 1200px;
      max-height: 90vh;
      overflow-y: auto;
      animation: modalShow 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
  }
  
  @keyframes modalShow {
      from {
          opacity: 0;
          transform: translate(-50%, -60%) scale(0.9);
      }
      to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
      }
  }
  
  .modal-content {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      border: 2px solid rgba(102, 126, 234, 0.2);
      position: relative;
  }
  
  .modal-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  }
  
  .modal-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2rem;
      color: white;
      position: relative;
  }
  
  .modal-header h2 {
      color: white;
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
      border: none;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  
  .modal-header h2::after,
  .modal-header h2::before {
      display: none;
  }
  
  .modal-header span {
      position: absolute;
      right: 2rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 28px;
      cursor: pointer;
      color: white;
      opacity: 0.8;
      transition: all 0.3s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
  }
  
  .modal-header span:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-50%) scale(1.1);
  }
  
  .modal-body {
      padding: 2.5rem;
      max-height: 60vh;
      overflow-y: auto;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  }
  
  .modal-footer {
      padding: 2rem;
      background: #fff;
      border-top: 2px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
  }
  
  /* ==================== è¡¨å•æ ·å¼ ==================== */
  .form-group {
      margin-bottom: 1.5rem;
  }
  
  .form-label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
  }
  
  .form-control, .form-select {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 14px;
      background: #fff;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      font-family: inherit;
      min-height: 45px;
  }
  
  .form-control:focus, .form-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
      transform: translateY(-2px);
  }
  
  /* Bootstrapç½‘æ ¼ç³»ç»Ÿä¿æŒ */
  .row {
      display: flex;
      flex-wrap: wrap;
      margin: 0 -0.75rem;
      width: 100%;
  }
  
  .col-md-3, .col-md-4, .col-md-6, .col-md-12 {
      padding: 0 0.75rem;
      flex-grow: 1;
      transition: all 0.3s ease;
  }
  
  .col-md-3 { flex: 0 0 25%; max-width: 25%; }
  .col-md-4 { flex: 0 0 33.333333%; max-width: 33.333333%; }
  .col-md-6 { flex: 0 0 50%; max-width: 50%; }
  .col-md-12 { flex: 0 0 100%; max-width: 100%; }
  
  .mb-3 {
      margin-bottom: 1.5rem !important;
  }
  
  /* ==================== æŒ‰é’®ç»„å¸ƒå±€ ==================== */
  div[style*="display: flex"][style*="justify-content: center"] {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
      gap: 1.5rem !important;
      margin: 2rem 0 !important;
      flex-wrap: wrap !important;
  }
  
  .action-buttons {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      margin-top: 2rem;
      flex-wrap: wrap;
      align-items: center;
  }
  
  .button-container {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
  }
  
  /* ==================== åˆ†å‰²çº¿ç¾åŒ– ==================== */
  hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #667eea, transparent);
      margin: 3rem 0;
      border-radius: 1px;
  }
  
  /* ==================== é”™è¯¯å’ŒæˆåŠŸçŠ¶æ€ ==================== */
  .error {
      border-color: #f56565 !important;
      box-shadow: 0 0 0 4px rgba(245, 101, 101, 0.15) !important;
  }
  
  .error-message {
      color: #e53e3e;
      font-size: 12px;
      margin-top: 0.5rem;
      font-weight: 500;
  }
  
  .success-message {
      color: #38a169;
      font-size: 12px;
      margin-top: 0.5rem;
      font-weight: 500;
  }
  
  /* ==================== åŠ¨ç”»æ•ˆæœ ==================== */
  @keyframes fadeInUp {
      from { 
          opacity: 0; 
          transform: translateY(30px); 
      }
      to { 
          opacity: 1; 
          transform: translateY(0); 
      }
  }
  
  @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
  }
  
  /* é¡µé¢åŠ è½½åŠ¨ç”» */
  section {
      animation: fadeInUp 0.6s ease-out;
  }
  
  section:nth-child(2) {
      animation-delay: 0.2s;
  }
  
  /* ==================== å“åº”å¼è®¾è®¡ ==================== */
  @media screen and (max-width: 1400px) {
      h1 {
          font-size: clamp(3rem, 6vw, 4rem);
          letter-spacing: 3px;
      }
      
      .container {
          width: 98%;
          padding: 1.5rem;
      }
      
      .users-table {
          font-size: 12px;
      }
      
      .users-table th,
      .users-table td {
          padding: 0.8rem 0.4rem;
      }
  }
  
  @media screen and (max-width: 1024px) {
      h1 {
          font-size: clamp(2.5rem, 5vw, 3.5rem);
          letter-spacing: 2px;
      }
      
      .search-form, #searchForm {
          flex-direction: column;
          align-items: stretch;
      }
      
      .search-form input,
      .search-form select,
      #searchForm input,
      #searchForm select {
          min-width: auto;
          width: 100%;
      }
      
      .users-table {
          font-size: 11px;
      }
      
      .users-table th,
      .users-table td {
          padding: 0.6rem 0.3rem;
      }
      
      .radio-group {
          flex-direction: column;
          align-items: stretch;
          gap: 1rem;
      }
  }
  
  @media screen and (max-width: 768px) {
      .container {
          margin: 10px;
          padding: 1rem;
          border-radius: 15px;
      }
      
      h1 {
          font-size: 2.5rem;
          margin-bottom: 2rem;
          letter-spacing: 1px;
      }
      
      h2 {
          font-size: 1.4rem;
          padding: 0.8rem 1rem;
      }
      
      section {
          padding: 1.5rem;
          margin-bottom: 1.5rem;
      }
      
      .modal {
          width: 95%;
          max-height: 90vh;
      }
      
      .modal-body {
          padding: 1.5rem;
      }
      
      .modal-footer {
          padding: 1rem 1.5rem;
          flex-direction: column;
      }
      
      .col-md-3, .col-md-4, .col-md-6 {
          flex: 0 0 100%;
          max-width: 100%;
          margin-bottom: 1rem;
      }
      
      .users-table {
          font-size: 10px;
      }
      
      .users-table th,
      .users-table td {
          padding: 0.4rem 0.2rem;
      }
      
      /* è¡¨æ ¼æ¨ªå‘æ»šåŠ¨ */
      .table-container {
          overflow-x: auto;
      }
      
      .users-table {
          min-width: 1400px;
      }
      
      div[style*="display: flex"][style*="justify-content: center"] {
          flex-direction: column;
          align-items: center;
      }
      
      .button, .btn-change, .btn-delete, .btn-button {
          min-width: 200px;
          margin-bottom: 0.5rem;
      }
  }
  
  @media screen and (max-width: 480px) {
      h1 {
          font-size: 2rem;
          letter-spacing: 1px;
      }
      
      .users-table th,
      .users-table td {
          padding: 0.3rem 0.15rem;
          font-size: 9px;
      }
      
      .button, .btn-change, .btn-delete, .btn-button {
          padding: 0.75rem 1rem;
          font-size: 12px;
          min-width: 150px;
      }

      .btn-change1, .btn-delete1 {
          padding: 0.1rem 0.1rem;
          font-size: 12px;
          min-width: 50px;
      }

      
      #firstPage, #prevPage, #nextPage, #lastPage {
          padding: 0.75rem 1rem;
          font-size: 12px;
          min-width: 80px;
      }
  }
  
  /* ==================== æ»šåŠ¨æ¡ç¾åŒ– ==================== */
  ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
  }
  
  ::-webkit-scrollbar-track {
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
      border-radius: 5px;
  }
  
  ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 5px;
      border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5a6fd8, #6a4190);
  }
  
  ::-webkit-scrollbar-corner {
      background: #f1f5f9;
  }
  
  /* ==================== ç‰¹æ®ŠåŠŸèƒ½æ ·å¼ ==================== */
  .badge {
      display: inline-block;
      padding: 0.4rem 0.8rem;
      font-size: 0.75rem;
      font-weight: 600;
      border-radius: 20px;
      text-align: center;
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.5px;
  }
  
  .badge-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
  }
  
  .badge-success {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
      box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
  }
  
  .badge-warning {
      background: linear-gradient(135deg, #ed8936, #dd6b20);
      color: white;
      box-shadow: 0 2px 8px rgba(237, 137, 54, 0.3);
  }
  
  .badge-danger {
      background: linear-gradient(135deg, #f56565, #e53e3e);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 101, 101, 0.3);
  }
  
  /* ==================== çŠ¶æ€æŒ‡ç¤ºå™¨ ==================== */
  .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 0.5rem;
      animation: pulse 2s infinite;
  }
  
  .status-active {
      background: linear-gradient(135deg, #48bb78, #38a169);
      box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.3);
  }
  
  .status-inactive {
      background: #a0aec0;
      box-shadow: 0 0 0 3px rgba(160, 174, 192, 0.2);
      animation: none;
  }
  
  /* ==================== å·¥å…·æç¤º ==================== */
  .tooltip {
      position: relative;
      cursor: help;
  }
  
  .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  
  .tooltip:hover::before {
      content: '';
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: rgba(0, 0, 0, 0.9);
      z-index: 1000;
  }
  
  /* ==================== é«˜çº§æ ·å¼å¢å¼º ==================== */
  .glass-morphism {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
  }
  
  .gradient-text {
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
  }
  
  /* ==================== åŠ è½½çŠ¶æ€ ==================== */
  .loading {
      position: relative;
      pointer-events: none;
      opacity: 0.7;
  }
  
  .loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 24px;
      height: 24px;
      margin: -12px 0 0 -12px;
      border: 3px solid #667eea;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
      to { transform: rotate(360deg); }
  }
  
  /* ==================== ç‰¹æ®Šè¾“å…¥æ§ä»¶æ ·å¼ ==================== */
  input[type="file"] {
      padding: 0.75rem;
      border: 2px dashed #667eea;
      border-radius: 12px;
      background: rgba(102, 126, 234, 0.05);
      transition: all 0.3s ease;
      cursor: pointer;
  }
  
  input[type="file"]:hover {
      border-color: #764ba2;
      background: rgba(118, 75, 162, 0.1);
      transform: translateY(-2px);
  }
  
  /* ==================== æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨ ==================== */
  .date-range {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(102, 126, 234, 0.2);
  }
  
  .date-range input[type="date"] {
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 0.5rem;
      background: white;
      transition: all 0.3s ease;
  }
  
  .date-range input[type="date"]:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  /* ==================== è¶…å¤§å±å¹•ä¼˜åŒ– ==================== */
  @media (min-width: 1600px) {
      .container {
          max-width: 1600px;
      }
      
      h1 {
          font-size: 6rem;
          letter-spacing: 6px;
      }
      
      h2 {
          font-size: 2.2rem;
      }
      
      .form-label {
          font-size: 1.2rem;
          margin-bottom: 10px;
      }
      
      .form-control,
      .form-select {
          font-size: 1.1rem;
          padding: 1rem 1.25rem;
          min-height: 50px;
      }
      
      .modal-header h2 {
          font-size: 2.2rem;
      }
      
      .modal {
          max-width: 1400px;
      }
  }
  
  @media (min-width: 2000px) {
      .modal {
          max-width: 1800px;
      }
      
      .row {
          gap: 20px;
      }
      
      h1 {
          font-size: 7rem;
          letter-spacing: 8px;
      }
  }

  .print-container {
    width: 100%;
    max-width: 1500px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
  }

  .print-header {
    text-align: center;
    margin-bottom: 20px;
  }

  .print-header h1 {
    margin-bottom: 10px;
  }  
  
  .print-header h11 {
    margin-bottom: 10px;
  }



  .print-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }

  .print-table th,
  .print-table td {
    border: 1px solid #000;
    padding: 8px;
    text-align: center;
  }

  .print-table th {
    background-color: #f0f0f0;
  }

  .print-footer {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }

  @media print {
    body * {
      visibility: hidden;
    }

    .print-container,
    .print-container * {
      visibility: visible;
    }

    .print-container {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      padding: 0;
    }

    .no-print {
      display: none !important;
    }
  }

  /* æ‰“å°ä¸“ç”¨æ ·å¼ */
  @media print {

    /* åŸºæœ¬æ‰“å°è®¾ç½® */
    @page {
      size: auto;
      margin: 10mm 10mm 10mm 10mm;
      /* å‡å°é¡µé¢è¾¹è· */
    }

    body {
      margin: 0;
      padding: 0;
      background: white;
    }

    /* éšè—éæ‰“å°å…ƒç´  */
    .no-print {
      display: none !important;
    }

    /* æ§åˆ¶æ‰“å°å®¹å™¨ */
    .print-container {
      width: 100%;
      margin: 0;
      padding: 0;
      page-break-after: avoid;
      /* é˜²æ­¢å®¹å™¨åè‡ªåŠ¨åˆ†é¡µ */
    }

    /* æ§åˆ¶è¡¨æ ¼æ‰“å° */
    table {
      width: 100% !important;
      page-break-inside: auto;
      border-collapse: collapse;
    }

    tr,
    td,
    th {
      page-break-inside: avoid;
      /* å°½é‡é¿å…è¡Œå†…åˆ†é¡µ */
    }

    /* å¦‚æœæŒ‰é’®åœ¨å®¹å™¨ä¸­ï¼Œå¯ä»¥ä¸ºå®¹å™¨æ·»åŠ æ ·å¼ */
    .print-footer .no-print {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
      margin-bottom: 10px;
      /* åº•éƒ¨ç•™ä¸€äº›ç©ºé—´ */
    }

    .button-container {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .action-buttons {
      display: flex !important;
      justify-content: flex-end !important;
      gap: 10px;
      width: 100%;
    }

    /* é‡ç½®å¯èƒ½å½±å“å¯¹é½çš„æ ·å¼ */
    .print-footer {
      width: 100%;
      box-sizing: border-box;
    }

    .no-print {
      width: 100%;
    }


    /* é¿å…å…ƒç´ äº§ç”Ÿæ— æ„ä¹‰çš„åˆ†é¡µ */
    * {
      overflow: visible !important;
    }

  /* ç¡®ä¿filter-groupä¸ä¼šå½±å“æ …æ ¼å¸ƒå±€ */  
  .filter-group {  
    width: 100%;  
    padding: 0;  
    margin: 0;  
  }  
  
  /* ç¡®ä¿æ¯ä¸ªrowæ˜¯flexå¸ƒå±€å¹¶ä¸”å¡«å……æ•´ä¸ªå®½åº¦ */  
  .filter-group .row {  
    display: flex;  
    width: 100%;  
    margin-left: 0;  
    margin-right: 0;  
  }  
  
  /* å…³é”®ä¿®å¤ï¼šç¡®ä¿col-md-4å®é™…å ç”¨33.33%çš„å®½åº¦ */  
  .filter-group .col-md-4 {  
    width: 33.33%;  
    flex: 0 0 33.33%;  
    max-width: 33.33%;  
    box-sizing: border-box;  
  }  
  
  /* ç¡®ä¿è¡¨å•å…ƒç´ å¡«å……æ•´ä¸ªåˆ—å®½ */  
  .filter-group .form-control {  
    width: 100%;  
    box-sizing: border-box;  
  }  
  
  /* ç¡®ä¿æ ‡ç­¾ä¸ä¼šå½±å“å¸ƒå±€ */  
  .filter-group label {  
    display: block;  
    width: 100%;  
    box-sizing: border-box;  
  }  
  
  /* å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ·»åŠ åª’ä½“æŸ¥è¯¢ä»¥ç¡®ä¿åœ¨å°å±å¹•ä¸Šæ­£ç¡®æ˜¾ç¤º */  
  @media (max-width: 768px) {  
    .filter-group .col-md-4 {  
      width: 100%;  
      flex: 0 0 100%;  
      max-width: 100%;  
    }  
  }  

  }

  
    /* ========== æ–°å¢ï¼šä¸ºè¡¨æ ¼å¤–å±‚åŠ ä¸€ä¸ªå›ºå®šé«˜åº¦+æ»šåŠ¨æ¡å®¹å™¨ ========== */  
    .table-container {  
      max-height: 1200px; /* æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´è¡¨æ ¼å®¹å™¨çš„æœ€å¤§é«˜åº¦*/  
      overflow-y: auto;  /* å½“å†…å®¹è¶…è¿‡æœ€å¤§é«˜åº¦æ—¶å‡ºç°å‚ç›´æ»šåŠ¨æ¡*/  
      border: 1px solid #ccc;  
      margin: 16px 0;  
    }  
    /* æœç´¢åŒºåŸŸ */  
    .search-container {  
      margin-bottom: 12px;  
    }  
    .search-container input {  
      width: 200px;  
      padding: 6px;  
    }  
    .search-container button {  
      padding: 6px 12px;  
      margin-left: 8px;  
      cursor: pointer;  
    }  

  </style>

<body>

  <script src="https://unpkg.com/xlsx-js-style@1.2.0/dist/xlsx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>


  <div class="container">
    <h1 class="page-title">
      <i class="fas fa-users-cog"></i>
      å®åŠ›ç®¡ç†
  </h1>
    <!-- æ¶ˆé˜²å‘˜ä¿¡æ¯è¡¨æ ¼å±•ç¤º -->
    <section>
      <h2>å®åŠ›ä¿¡æ¯åˆ—è¡¨</h2>

      <form id="searchForm" class="search-form">
        <div class="row">
        <input type="text" id="searchNumber" placeholder="ç¼–å·">
        <input type="text" id="searchName" placeholder="å§“å">
        <select class="form-select" id="searchGender" placeholder="è¯·é€‰æ‹©æ€§åˆ«">
          <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
          <option value="ç”·">ç”·</option>
          <option value="å¥³">å¥³</option>
        </select>
        <input type="number" id="searchAgeMin" placeholder="å¹´é¾„æœ€å°å€¼">
        <input type="number" id="searchAgeMax" placeholder="å¹´é¾„æœ€å¤§å€¼">
        </div>
        <div class="row">
        <select class="form-select" id="searchPosition" placeholder="è¯·é€‰æ‹©èŒåŠ¡">
          <option value="">è¯·é€‰æ‹©èŒåŠ¡</option>
          <option value="ä¸“èŒæ¶ˆé˜²å‘˜">ä¸“èŒæ¶ˆé˜²å‘˜</option>
          <option value="æ¶ˆé˜²æ–‡å‘˜">æ¶ˆé˜²æ–‡å‘˜</option>
          <option value="å…¶å®ƒ">å…¶å®ƒ</option>
        </select>
        <select class="form-select" id="searchTeam" placeholder="è¯·é€‰æ‹©å•ä½">
          <option value="">è¯·é€‰æ‹©å•ä½</option>
          <option value="é˜²ç«æˆ˜çº¿">é˜²ç«æˆ˜çº¿</option>  
          <option value="ç­ç«æˆ˜çº¿">ç­ç«æˆ˜çº¿</option>  
          <option value="æ”¿æ²»éƒ¨æˆ˜çº¿">æ”¿æ²»éƒ¨æˆ˜çº¿</option>  
          <option value="åå‹¤æˆ˜çº¿">åå‹¤æˆ˜çº¿</option>  
          <option value="æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™">æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™</option>  
          <option value="æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ">æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ</option>  
          <option value="ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™">é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™">å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™">æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="è”¡å››è·¯ç‰¹å‹¤ç«™">è”¡å››è·¯ç‰¹å‹¤ç«™</option>  
          <option value="è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™">ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™">é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="é“§å­æ¶ˆé˜²æ•‘æ´ç«™">é“§å­æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™">ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
          <option value="æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™">æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™</option>  
          <option value="å…¶å®ƒ">å…¶å®ƒ</option>
        </select>
        <select class="form-select" id="searchYear" placeholder="è¯·é€‰æ‹©å·¥ä½œå¹´é™">
          <option value="">è¯·é€‰æ‹©å·¥ä½œå¹´é™</option>
          <option value="1å¹´">1å¹´</option>
          <option value="2å¹´">2å¹´</option>
          <option value="3å¹´">3å¹´</option>
          <option value="4å¹´">4å¹´</option>
          <option value="5å¹´">5å¹´</option>
          <option value="6å¹´">6å¹´</option>
          <option value="7å¹´">7å¹´</option>
          <option value="8å¹´">8å¹´</option>
          <option value="9å¹´">9å¹´</option>
          <option value="10å¹´å«ä»¥ä¸Š">10å¹´å«ä»¥ä¸Š</option>
          <option value="å…¶å®ƒ">å…¶å®ƒ</option>
        </select>
        </div>
        <!-- å¯ä»¥ç»§ç»­æ·»åŠ æœç´¢æ¡ä»¶ -->
      </form>
      <div class="row">
        <div class="col-md-12 mb-3"  style="display: flex; justify-content: center; gap: 5px; margin-top: 5px; margin-bottom: 5px;">
        <button type="button" onclick="searchFirefighters()" class="btn-change">æœç´¢</button>
        <button type="button" onclick="resetSearch()" class="btn-delete">é‡ç½®</button>
        <button type="button" onclick="showAddFirefighterModal()" class="btn-button">æ·»åŠ å®åŠ›</button>
        <button type="button" onclick="printnow()" class="btn-button">æ‰“å°æœç´¢å®åŠ›</button> 
        <button type="button" onclick="printall()" class="btn-button">æ‰“å°æ‰€æœ‰å®åŠ›</button>
      </div>
      </div>

      <div class="radio-group">
              <label style="font-style: solid; font-size: 20px;">æ‰“å°æ ¼å¼ï¼š</label>
              <label>
                <input type="radio" name="printoutputFormat" value="print" checked> æ‰“å°
              </label>
              <label>
                <input type="radio" name="printoutputFormat" value="pdf"> PDF
              </label>
              <label>
                <input type="radio" name="printoutputFormat" value="excel"> Excel
              </label>
          </div>
    </section>     

      <section>
      <div class="table-container">
      <table id="firefightersTable" class="users-table" style="width: 100%; table-layout: fixed; border-collapse: collapse; justify-content: center;">
        <thead>
          <tr>
            <th style="width: 2%;"><input type="checkbox" id="selectAll" title="å…¨é€‰/å–æ¶ˆå…¨é€‰"></th>
            <th style="width: 10%;">ç¼–å·</th>
            <th style="width: 5%;">å§“å</th>
            <th style="width: 4%;">æ€§åˆ«</th>
            <th style="width: 6%;">å‡ºç”Ÿå¹´æœˆ</th>
            <th style="width: 4%;">å¹´é¾„</th>
            <th style="width: 6%;">èŒåŠ¡</th>
            <th style="width: 5%;">å•ä½</th>
            <th style="width: 6%;">å·¥ä½œå¹´é™</th>
            <th style="width: 5%;">å¸½ç±»å·</th>
            <th style="width: 5%;">æœè£…å·</th>
            <th style="width: 5%;">é‹ç±»å·</th>
            <th style="width: 3%;">èº«é«˜</th>
            <th style="width: 3%;">èƒ¸å›´</th>
            <th style="width: 3%;">è…°å›´</th>
            <th style="width: 3%;">å¤´å›´</th>
            <th style="width: 4%;">å¯ç”¨ä½™é¢</th>
            <th style="width: 4%;">ç»è´¹æ¥æº</th>
            <th style="width: 4%;">å¤‡æ³¨</th>
            <th style="width: 4%;">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <!-- æ•°æ®å°†é€šè¿‡AJAXåŠ¨æ€åŠ è½½ -->
        </tbody>
      </table>
    </div>

    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 10px; margin-bottom: 5px;">
      <button id="firstPage" class="bg-green-500 text-white px-2 py-1 rounded" onclick="changePage1()">é¦–é¡µ</button>         
      <button id="prevPage" class="bg-green-500 text-white px-2 py-1 rounded" onclick="changePage(-1)">å‰ä¸€é¡µ</button>  
      <div id="pageInfo" class="text-center text-lg font-bold text-gray-700"></div>  
      <button id="nextPage" class="bg-green-500 text-white px-2 py-1 rounded" onclick="changePage(1)">åä¸€é¡µ</button>
      <button id="lastPage" class="bg-green-500 text-white px-2 py-1 rounded" onclick="changePageN()">å°¾é¡µ</button>   
  </div>      
  <!-- åœ¨æœç´¢è¡¨å•ä¸‹æ–¹ï¼ŒæŒ‰é’®åŒºåŸŸæ·»åŠ æ‰¹é‡åˆ é™¤æŒ‰é’® -->
  <div style="display: flex; justify-content: center; gap: 15px; margin-top: 10px; margin-bottom: 5px;">
    <button onclick="showChangeTeamModal()" class="button">å®åŠ›å•ä½å˜æ›´</button>
    <button class="button" id="batchUpdateFundsBtn">æ‰¹é‡ä¿®æ”¹ç»è´¹</button>  
    <button id="batchDeleteBtn" class="button">æ‰¹é‡åˆ é™¤</button>
    <button onclick="showReportModal()" class="button">æ‰“å°æŠ¥è¡¨</button>
  </div>        
    </section>

    <!-- Excelæ¨¡æ¿ä¸‹è½½ + å¯¼å…¥ -->
    <section>
      <h2>æ¨¡ç‰ˆä¸Šä¼ å®åŠ›ä¿¡æ¯</h2>
      <form id="importForm"
        style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 15px; margin-top: 10px; margin-bottom: 10px;">
        <a href="/firefighters/template/firefighters_template.xlsx" class="button"
          style="white-space: nowrap;">ä¸‹è½½Excelæ¨¡æ¿</a>
        <label for="excelFile" style="margin: 0 5px; white-space: nowrap;">ä¸Šä¼ Excelæ–‡ä»¶ï¼š</label>
        <input type="file" id="excelFile" name="excelFile" accept=".xlsx" required style="margin: 0 5px;">
        <button type="submit" class="button" style="white-space: nowrap;">å¯¼å…¥</button>
      </form>
    </section>
    
  </div>


  <!-- æ¨¡æ€çª—å£ï¼ˆç”¨äºæ·»åŠ å’Œä¿®æ”¹æ¶ˆé˜²å‘˜ä¿¡æ¯ï¼‰ -->
  <!-- èƒŒæ™¯é®ç½© -->
  <div class="modal-backdrop" id="modalBackdrop"></div>
  <!-- æ¨¡æ€çª—å£ï¼ˆç”¨äºæ·»åŠ å’Œä¿®æ”¹æ¶ˆé˜²å‘˜ä¿¡æ¯ï¼‰ -->
  <div id="firefighterModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle" class="text-5xl text-center">æ·»åŠ å®åŠ›</h2>
        <span id="closeModal" style="cursor:pointer;">&times;</span>
      </div>
      
      <div class="modal-body">
        <form id="firefighterForm">
          <input type="hidden" id="firefighterId" name="id">
          <!-- ç¼–å· -->
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="modalNumber" class="form-label">ç¼–å·</label>
              <input type="text" class="form-control" id="modalNumber" name="number" required>
            </div>
            <!-- å§“å -->
            <div class="col-md-4 mb-3">
              <label for="modalName" class="form-label">å§“å</label>
              <input type="text" class="form-control" id="modalName" name="name" required>
            </div>
            <!-- æ€§åˆ« -->
            <div class="col-md-4 mb-3">
              <label for="modalGender" class="form-label">æ€§åˆ«</label>
              <select class="form-select" id="modalGender" name="gender">
                <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                <option value="ç”·">ç”·</option>
                <option value="å¥³">å¥³</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- å‡ºç”Ÿå¹´æœˆ -->
            <div class="col-md-4 mb-3">
              <label for="modalBirthDate" class="form-label">å‡ºç”Ÿå¹´æœˆ</label>
              <input type="date" class="form-control" id="modalBirthDate" name="birthDate">
            </div>
            <!-- å¹´é¾„ -->
            <div class="col-md-4 mb-3">
              <label for="modalAge" class="form-label">å¹´é¾„</label>
              <input type="number" class="form-control" id="modalAge" name="age" readonly>
            </div>
            <!-- èŒåŠ¡ -->
            <div class="col-md-4 mb-3">
              <label for="modalPosition" class="form-label">èŒåŠ¡</label>
              <select class="form-select" id="modalPosition" name="position">
                <option value="">è¯·é€‰æ‹©èŒåŠ¡</option>
                <option value="ä¸“èŒæ¶ˆé˜²å‘˜">ä¸“èŒæ¶ˆé˜²å‘˜</option>
                <option value="æ¶ˆé˜²æ–‡å‘˜">æ¶ˆé˜²æ–‡å‘˜</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- å•ä½ -->
            <div class="col-md-6 mb-3">
              <label for="modalTeam" class="form-label">å•ä½</label>
              <select class="form-select" id="modalTeam" name="team">
                <option value="">è¯·é€‰æ‹©å•ä½</option>
                <option value="é˜²ç«æˆ˜çº¿">é˜²ç«æˆ˜çº¿</option>  
                <option value="ç­ç«æˆ˜çº¿">ç­ç«æˆ˜çº¿</option>  
                <option value="æ”¿æ²»éƒ¨æˆ˜çº¿">æ”¿æ²»éƒ¨æˆ˜çº¿</option>  
                <option value="åå‹¤æˆ˜çº¿">åå‹¤æˆ˜çº¿</option>  
                <option value="æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™">æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™</option>  
                <option value="æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ">æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ</option>  
                <option value="ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™">é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™">å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™">æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="è”¡å››è·¯ç‰¹å‹¤ç«™">è”¡å››è·¯ç‰¹å‹¤ç«™</option>  
                <option value="è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™">ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™">é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é“§å­æ¶ˆé˜²æ•‘æ´ç«™">é“§å­æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™">ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™">æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
            <!--å·¥ä½œå¹´é™ -->
            <div class="col-md-6 mb-3">
              <label for="modalYear" class="form-label">å·¥ä½œå¹´é™</label>
              <select class="form-select" id="modalYear" name="year">
                <option value="">è¯·é€‰æ‹©å·¥ä½œå¹´é™</option>
                <option value="1å¹´">1å¹´</option>
                <option value="2å¹´">2å¹´</option>
                <option value="3å¹´">3å¹´</option>
                <option value="4å¹´">4å¹´</option>
                <option value="5å¹´">5å¹´</option>
                <option value="6å¹´">6å¹´</option>
                <option value="7å¹´">7å¹´</option>
                <option value="8å¹´">8å¹´</option>
                <option value="9å¹´">9å¹´</option>
                <option value="10å¹´å«ä»¥ä¸Š">10å¹´å«ä»¥ä¸Š</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- èº«é«˜ -->
            <div class="col-md-3 mb-3">
              <label for="modalShengao" class="form-label">èº«é«˜</label>
              <input type="number" class="form-control" id="modalShengao" name="shengao" min="1" max="250" placeholder="å•ä½ä¸ºcm">
            </div>

            <!-- èƒ¸å›´ -->
            <div class="col-md-3 mb-3">
              <label for="modalXiongwei" class="form-label">èƒ¸å›´</label>
              <input class="form-control" id="modalXiongwei" name="xiongwei" min="1" max="250" placeholder="å•ä½ä¸ºcm">
            </div>
            <!-- è…°å›´ -->
            <div class="col-md-3 mb-3">
              <label for="modalYaowei" class="form-label">è…°å›´</label>
              <input class="form-control" id="modalYaowei" name="yaowei" min="1" max="250" placeholder="å•ä½ä¸ºcm">
            </div>
            <!-- å¤´å›´ -->
            <div class="col-md-3 mb-3">
              <label for="modalTouwei" class="form-label">å¤´å›´</label>
              <select class="form-select" id="modalTouwei" name="touwei">
                <option value="">è¯·é€‰æ‹©å¤´å›´</option>
                <option value="54">54</option>
                <option value="55">55</option>
                <option value="56">56</option>
                <option value="57">57</option>
                <option value="58">58</option>
                <option value="59">59</option>
                <option value="60">60</option>
                <option value="61">61</option>
                <option value="62">62</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
          </div>


          <div class="row">
            <!-- é‹ç±»å· -->
            <div class="col-md-4 mb-3">
              <label for="modalXieleihao" class="form-label">é‹ç±»å·</label>
              <select class="form-select" id="modalXieleihao" name="xieleihao">
                <option value="">è¯·é€‰æ‹©é‹å·</option>
                <option value="220">220</option>
                <option value="225">225</option>
                <option value="230">230</option>
                <option value="235">235</option>
                <option value="240">240</option>
                <option value="245">245</option>
                <option value="250">250</option>
                <option value="255">255</option>
                <option value="260">260</option>
                <option value="265">265</option>
                <option value="270">270</option>
                <option value="275">275</option>
                <option value="280">280</option>
                <option value="285">285</option>
                <option value="290">290</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
            <!-- æœè£…å· -->
            <div class="col-md-4 mb-3">
              <label for="modalFuzhuanghao" class="form-label">æœè£…å·</label>
              <select class="form-select" id="modalFuzhuanghao" name="fuzhuanghao">
                <option value="">è¯·é€‰æ‹©æœè£…å·</option>
                <option value="160/80">160/80</option>
                <option value="160/84">160/84</option>
                <option value="160/88">160/88</option>
                <option value="160/92">160/92</option>
                <option value="160/96">160/96</option>
                <option value="160/100">160/100</option>
                <option value="160/108">160/108</option>
                <option value="165/80">165/80</option>
                <option value="165/84">165/84</option>
                <option value="165/88">165/88</option>
                <option value="165/92">165/92</option>
                <option value="165/96">165/96</option>
                <option value="165/100">165/100</option>
                <option value="165/104">165/104</option>
                <option value="165/108">165/108</option>
                <option value="170/80">170/80</option>
                <option value="170/84">170/84</option>
                <option value="170/88">170/88</option>
                <option value="170/92">170/92</option>
                <option value="170/96">170/96</option>
                <option value="170/100">170/100</option>
                <option value="170/104">170/104</option>
                <option value="170/108">170/108</option>
                <option value="170/112">170/112</option>
                <option value="175/84">175/84</option>
                <option value="175/88">175/88</option>
                <option value="175/92">175/92</option>
                <option value="175/96">175/96</option>
                <option value="175/100">175/100</option>
                <option value="175/104">175/104</option>
                <option value="175/108">175/108</option>
                <option value="175/112">175/112</option>
                <option value="175/116">175/116</option>
                <option value="175/120">175/120</option>
                <option value="180/88">180/88</option>
                <option value="180/92">180/92</option>
                <option value="180/96">180/96</option>
                <option value="180/100">180/100</option>
                <option value="180/104">180/104</option>
                <option value="180/108">180/108</option>
                <option value="180/112">180/112</option>
                <option value="180/116">180/116</option>
                <option value="180/120">180/120</option>
                <option value="185/92">185/92</option>
                <option value="185/96">185/96</option>
                <option value="185/100">185/100</option>
                <option value="185/104">185/104</option>
                <option value="185/108">185/108</option>
                <option value="185/112">185/112</option>
                <option value="185/116">185/116</option>
                <option value="185/120">185/120</option>
                <option value="190/92">190/92</option>
                <option value="190/96">190/96</option>
                <option value="190/100">190/100</option>
                <option value="190/112">190/112</option>
                <option value="190/116">190/116</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>

            <!-- å¸½ç±»å· -->
            <div class="col-md-4 mb-3">
              <label for="modalMaoleihao" class="form-label">å¸½ç±»å·</label>
              <select class="form-select" id="modalMaoleihao" name="maoleihao">
                <option value="">è¯·é€‰æ‹©å¸½å·</option>
                <option value="54">54</option>
                <option value="55">55</option>
                <option value="56">56</option>
                <option value="57">57</option>
                <option value="58">58</option>
                <option value="59">59</option>
                <option value="60">60</option>
                <option value="61">61</option>
                <option value="62">62</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- å¯ç”¨ä½™é¢ -->
            <div class="col-md-6 mb-3">
              <label for="modalKeyongyue" class="form-label">å¯ç”¨ä½™é¢</label>
              <input class="form-control" id="modalKeyongyue" name="keyongyue">
            </div>
            <div class="col-md-6 mb-3">
              <label for="modalJingfeilaiyuan" class="form-label">ç»è´¹æ¥æº</label>
              <select class="form-select" id="modalJingfeilaiyuan" name="jingfeilaiyuan">
                <option value="">è¯·é€‰æ‹©ç»è´¹æ¥æº</option>
                <option value="æ”¯é˜Ÿç»è´¹">æ”¯é˜Ÿç»è´¹</option>
                <option value="å¤§é˜Ÿç»è´¹">å¤§é˜Ÿç»è´¹</option>
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
              </select>
            </div>
          </div>

          <div class="row">
            <!-- å¤‡æ³¨ -->
            <div class="col-md-12 mb-3">
              <label for="modalRemarks" class="form-label">å¤‡æ³¨</label>
              <input class="form-control" id="modalRemarks" name="remarks">
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button id="cancelModal" class="button">å–æ¶ˆ</button>
        <button id="saveFirefighter" class="button">ç¡®è®¤æ·»åŠ </button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ€çª—å£ï¼ˆç”¨äºå±•ç¤ºå¯¼å…¥çš„Excelæ•°æ®ï¼‰ -->
  <div id="importModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>é¢„è§ˆå¯¼å…¥çš„æ•°æ®</h2>
        <span id="closeImportModal" style="cursor:pointer;">&times;</span>
      </div>
      <div class="modal-body">
        <table id="importPreviewTable" class="users-table">
          <!-- åŠ¨æ€ç”Ÿæˆè¡¨æ ¼ -->
        </table>
      </div>
      <div class="modal-footer">
        <button id="confirmImport" class="button">ç¡®è®¤å¯¼å…¥</button>
        <button id="cancelImport" class="button">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- æ·»åŠ å•ä½å˜æ›´æ¨¡æ€çª—å£ -->
  <div id="changeTeamModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>å®åŠ›å•ä½å˜æ›´</h2>
        <span id="closeChangeTeamModal" style="cursor:pointer;">&times;</span>
      </div>
      <div class="modal-body">
        <table id="changeTeamTable" class="users-table">
          <thead>
            <tr>
              <th>ç¼–å·</th>
              <th>å§“å</th>
              <th>æ€§åˆ«</th>
              <th>å¹´é¾„</th>
              <th>ç°å•ä½</th>
              <th>å˜æ›´å•ä½</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            <!-- æ•°æ®å°†åŠ¨æ€å¡«å…… -->
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button id="submitChangeTeam" class="button">ç¡®è®¤æäº¤</button>
        <button id="cancelChangeTeam" class="button">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- èƒŒæ™¯é®ç½© -->
  <div class="modal-backdrop" id="reportModalBackdrop"></div>

  <!-- æŠ¥è¡¨é€‰æ‹©æ¨¡æ€çª—å£ -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>æ‰“å°æŠ¥è¡¨</h2>
        <span class="close" onclick="closeReportModal()">&times;</span>
      </div>

      <div class="modal-body">
        <form id="reportForm">

          <div class="row">
            <div class="col-md-12 mb-3">
              <label for="reportType">æŠ¥è¡¨ç±»å‹ï¼š</label>
              <select id="reportType" class="form-control">
                <option value="personnel">äººå‘˜åŸºæœ¬ä¿¡æ¯è¡¨</option>
                <option value="equipment">äººå‘˜è£…å¤‡é…å‘è¡¨</option>
                <option value="bodySize">äººå‘˜ä½“å‹å°ºå¯¸è¡¨</option>
                <option value="teamSummary">é˜Ÿä¼äººå‘˜ç»Ÿè®¡è¡¨</option>
                <option value="changeHistory">å•ä½å˜æ›´è®°å½•è¡¨</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12 mb-3">
              <label for="teamFilter">å•ä½ç­›é€‰ï¼š</label>
              <select id="teamFilter" class="form-control">
                <option value="">å…¨éƒ¨å•ä½</option>
                <option value="é˜²ç«æˆ˜çº¿">é˜²ç«æˆ˜çº¿</option>  
                <option value="ç­ç«æˆ˜çº¿">ç­ç«æˆ˜çº¿</option>  
                <option value="æ”¿æ²»éƒ¨æˆ˜çº¿">æ”¿æ²»éƒ¨æˆ˜çº¿</option>  
                <option value="åå‹¤æˆ˜çº¿">åå‹¤æˆ˜çº¿</option>  
                <option value="æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™">æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™</option>  
                <option value="æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ">æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ</option>  
                <option value="ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™">é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™">å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™">æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="è”¡å››è·¯ç‰¹å‹¤ç«™">è”¡å››è·¯ç‰¹å‹¤ç«™</option>  
                <option value="è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™">ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™">é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é“§å­æ¶ˆé˜²æ•‘æ´ç«™">é“§å­æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™">ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™">æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                <!-- å…¶ä»–å•ä½é€‰é¡¹ï¼Œä¸ä¹‹å‰çš„å•ä½åˆ—è¡¨ä¿æŒä¸€è‡´ -->
              </select>
            </div>
          </div>

          <!-- äººå‘˜ä¿¡æ¯æŠ¥è¡¨ç­›é€‰æ¡ä»¶ -->
          <div id="personnelFilters" class="filter-group" style="width: 100%; padding: 0; margin: 0;">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="genderFilter">æ€§åˆ«ç­›é€‰ï¼š</label>
                <select id="genderFilter" class="form-control">
                  <option value="">å…¨éƒ¨</option>
                  <option value="ç”·">ç”·</option>
                  <option value="å¥³">å¥³</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label for="ageMin">æœ€å°å¹´é¾„ï¼š</label>
                <input type="number" id="ageMin" class="form-control">
              </div>
              <div class="col-md-4 mb-3">
                <label for="ageMax">æœ€å¤§å¹´é¾„ï¼š</label>
                <input type="number" id="ageMax" class="form-control">
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="positionFilter">èŒåŠ¡ç­›é€‰ï¼š</label>
                <select id="positionFilter" class="form-control">
                  <option value="">å…¨éƒ¨èŒåŠ¡</option>
                  <option value="ä¸“èŒæ¶ˆé˜²å‘˜">ä¸“èŒæ¶ˆé˜²å‘˜</option>
                  <option value="æ¶ˆé˜²æ–‡å‘˜">æ¶ˆé˜²æ–‡å‘˜</option>
                  <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label for="yearMin">æœ€çŸ­å·¥ä½œå¹´é™ï¼š</label>
                <select id="yearMinFilter" class="form-control">
                  <option value="">ä¸é™</option>
                  <option value="1å¹´">1å¹´</option>
                  <option value="2å¹´">2å¹´</option>
                  <option value="3å¹´">3å¹´</option>
                  <option value="4å¹´">4å¹´</option>
                  <option value="5å¹´">5å¹´</option>
                  <option value="6å¹´">6å¹´</option>
                  <option value="7å¹´">7å¹´</option>
                  <option value="8å¹´">8å¹´</option>
                  <option value="9å¹´">9å¹´</option>
                  <option value="10å¹´å«ä»¥ä¸Š">10å¹´å«ä»¥ä¸Š</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label for="yearMax">æœ€é•¿å·¥ä½œå¹´é™ï¼š</label>
                <select id="yearMaxFilter" class="form-control">
                  <option value="">ä¸é™</option>
                  <option value="1å¹´">1å¹´</option>
                  <option value="2å¹´">2å¹´</option>
                  <option value="3å¹´">3å¹´</option>
                  <option value="4å¹´">4å¹´</option>
                  <option value="5å¹´">5å¹´</option>
                  <option value="6å¹´">6å¹´</option>
                  <option value="7å¹´">7å¹´</option>
                  <option value="8å¹´">8å¹´</option>
                  <option value="9å¹´">9å¹´</option>
                  <option value="10å¹´å«ä»¥ä¸Š">10å¹´å«ä»¥ä¸Š</option>
                </select>
              </div>
            </div>
          </div>

          <!-- è£…å¤‡é…å‘ç­›é€‰æ¡ä»¶ -->
          <div id="equipmentFilters" class="filter-group" style="display:none; width: 100%; padding: 0; margin: 0;">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="hatSizeFilter">å¸½ç±»å·ç­›é€‰ï¼š</label>
                <select id="hatSizeFilter" class="form-control">
                  <option value="">å…¨éƒ¨</option>
                  <option value="54">54</option>
                  <option value="55">55</option>
                  <option value="56">56</option>
                  <option value="57">57</option>
                  <option value="58">58</option>
                  <option value="59">59</option>
                  <option value="60">60</option>
                  <option value="61">61</option>
                  <option value="62">62</option>
                  <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label for="clothingSizeFilter">æœè£…å·ç­›é€‰ï¼š</label>
                <select id="clothingSizeFilter" class="form-control">
                  <option value="">å…¨éƒ¨</option>
                  <option value="160/80">160/80</option>
                  <option value="160/84">160/84</option>
                  <option value="160/88">160/88</option>
                  <option value="160/92">160/92</option>
                  <option value="160/96">160/96</option>
                  <option value="160/100">160/100</option>
                  <option value="160/108">160/108</option>
                  <option value="165/80">165/80</option>
                  <option value="165/84">165/84</option>
                  <option value="165/88">165/88</option>
                  <option value="165/92">165/92</option>
                  <option value="165/96">165/96</option>
                  <option value="165/100">165/100</option>
                  <option value="165/104">165/104</option>
                  <option value="165/108">165/108</option>
                  <option value="170/80">170/80</option>
                  <option value="170/84">170/84</option>
                  <option value="170/88">170/88</option>
                  <option value="170/92">170/92</option>
                  <option value="170/96">170/96</option>
                  <option value="170/100">170/100</option>
                  <option value="170/104">170/104</option>
                  <option value="170/108">170/108</option>
                  <option value="170/112">170/112</option>
                  <option value="175/84">175/84</option>
                  <option value="175/88">175/88</option>
                  <option value="175/92">175/92</option>
                  <option value="175/96">175/96</option>
                  <option value="175/100">175/100</option>
                  <option value="175/104">175/104</option>
                  <option value="175/108">175/108</option>
                  <option value="175/112">175/112</option>
                  <option value="175/116">175/116</option>
                  <option value="175/120">175/120</option>
                  <option value="180/88">180/88</option>
                  <option value="180/92">180/92</option>
                  <option value="180/96">180/96</option>
                  <option value="180/100">180/100</option>
                  <option value="180/104">180/104</option>
                  <option value="180/108">180/108</option>
                  <option value="180/112">180/112</option>
                  <option value="180/116">180/116</option>
                  <option value="180/120">180/120</option>
                  <option value="185/92">185/92</option>
                  <option value="185/96">185/96</option>
                  <option value="185/100">185/100</option>
                  <option value="185/104">185/104</option>
                  <option value="185/108">185/108</option>
                  <option value="185/112">185/112</option>
                  <option value="185/116">185/116</option>
                  <option value="185/120">185/120</option>
                  <option value="190/92">190/92</option>
                  <option value="190/96">190/96</option>
                  <option value="190/100">190/100</option>
                  <option value="190/112">190/112</option>
                  <option value="190/116">190/116</option>
                  <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                </select>
              </div>

              <div class="col-md-4 mb-3">
                <label for="shoeSizeFilter">é‹ç±»å·ç­›é€‰ï¼š</label>
                <select id="shoeSizeFilter" class="form-control">
                  <option value="">å…¨éƒ¨</option>
                  <option value="220">220</option>
                  <option value="225">225</option>
                  <option value="230">230</option>
                  <option value="235">235</option>
                  <option value="240">240</option>
                  <option value="245">245</option>
                  <option value="250">250</option>
                  <option value="255">255</option>
                  <option value="260">260</option>
                  <option value="265">265</option>
                  <option value="270">270</option>
                  <option value="275">275</option>
                  <option value="280">280</option>
                  <option value="285">285</option>
                  <option value="290">290</option>
                  <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ä½“å‹å°ºå¯¸ç­›é€‰æ¡ä»¶ -->
          <div id="bodySizeFilters" class="filter-group" style="display:none; width: 100%; padding: 0; margin: 0;">
            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="heightMin">æœ€å°èº«é«˜(CM)ï¼š</label>
                <input type="number" id="heightMin" class="form-control">
              </div>
              <div class="col-md-3 mb-3">
                <label for="heightMax">æœ€å¤§èº«é«˜(CM)ï¼š</label>
                <input type="number" id="heightMax" class="form-control">
              </div>


              <div class="col-md-3 mb-3">
                <label for="chestMin">æœ€å°èƒ¸å›´(CM)ï¼š</label>
                <input type="number" id="chestMin" class="form-control">
              </div>
              <div class="col-md-3 mb-3">
                <label for="chestMax">æœ€å¤§èƒ¸å›´(CM)ï¼š</label>
                <input type="number" id="chestMax" class="form-control">
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="waistMin">æœ€å°è…°å›´(CM)ï¼š</label>
                <input type="number" id="waistMin" class="form-control">
              </div>
              <div class="col-md-3 mb-3">
                <label for="waistMax">æœ€å¤§è…°å›´(CM)ï¼š</label>
                <input type="number" id="waistMax" class="form-control">
              </div>

              <div class="col-md-3 mb-3">
                <label for="headMin">æœ€å°å¤´å›´(CM)ï¼š</label>
                <input type="number" id="headMin" class="form-control">
              </div>
              <div class="col-md-3 mb-3">
                <label for="headMax">æœ€å¤§å¤´å›´(CM)ï¼š</label>
                <input type="number" id="headMax" class="form-control">
              </div>
            </div>
          </div>

          <!-- å•ä½å˜æ›´è®°å½•ç­›é€‰æ¡ä»¶ -->
          <div id="changeHistoryFilters" class="filter-group" style="display:none; width: 100%; padding: 0; margin: 0;">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="startDate">å¼€å§‹æ—¥æœŸï¼š</label>
                <input type="date" id="startDate" class="form-control">
              </div>
              <div class="col-md-4 mb-3">
                <label for="endDate">ç»“æŸæ—¥æœŸï¼š</label>
                <input type="date" id="endDate" class="form-control">
              </div>

              <div class="col-md-4 mb-3">
                <label for="oldTeamFilter">åŸå•ä½ç­›é€‰ï¼š</label>
                <select id="oldTeamFilter" class="form-control">
                  <option value="">å…¨éƒ¨å•ä½</option>
                  <option value="é˜²ç«æˆ˜çº¿">é˜²ç«æˆ˜çº¿</option>  
                  <option value="ç­ç«æˆ˜çº¿">ç­ç«æˆ˜çº¿</option>  
                  <option value="æ”¿æ²»éƒ¨æˆ˜çº¿">æ”¿æ²»éƒ¨æˆ˜çº¿</option>  
                  <option value="åå‹¤æˆ˜çº¿">åå‹¤æˆ˜çº¿</option>  
                  <option value="æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™">æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™</option>  
                  <option value="æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ">æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ</option>  
                  <option value="ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™">é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™">å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™">æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="è”¡å››è·¯ç‰¹å‹¤ç«™">è”¡å››è·¯ç‰¹å‹¤ç«™</option>  
                  <option value="è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™">ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™">é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="é“§å­æ¶ˆé˜²æ•‘æ´ç«™">é“§å­æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™">ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                  <option value="æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™">æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™</option>  
                  <option value="å…¶å®ƒ">å…¶å®ƒ</option>
                  <!-- å…¶ä»–å•ä½é€‰é¡¹ï¼Œä¸ä¹‹å‰çš„å•ä½åˆ—è¡¨ä¿æŒä¸€è‡´ -->
                </select>
              </div>
            </div>
          </div>

          <!-- æ’åºé€‰é¡¹ -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="sortField">æ’åºå­—æ®µï¼š</label>
              <select id="sortField" class="form-control">
                <option value="">é»˜è®¤æ’åº</option>
                <option value="number">æŒ‰ç¼–å·</option>
                <option value="name">æŒ‰å§“å</option>
                <option value="age">æŒ‰å¹´é¾„</option>
                <!-- åŠ¨æ€æ˜¾ç¤ºåŸºäºæŠ¥è¡¨ç±»å‹çš„æ’åºé€‰é¡¹ -->
              </select>
            </div>

            <div class="col-md-6 mb-3">
              <label for="sortOrder">æ’åºæ–¹å¼ï¼š</label>
              <select id="sortOrder" class="form-control">
                <option value="asc">å‡åº</option>
                <option value="desc">é™åº</option>
              </select>
            </div>
          </div>


          <div class="row">
            <div class="col-md-12 mb-3">
              <label>è¾“å‡ºæ ¼å¼ï¼š</label>
              <div class="radio-group">
                <label>
                  <input type="radio" name="outputFormat" value="print" checked> æ‰“å°
                </label>
                <label>
                  <input type="radio" name="outputFormat" value="pdf"> PDF
                </label>
                <label>
                  <input type="radio" name="outputFormat" value="excel"> Excel
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button onclick="generateReport()" class="button">ç”ŸæˆæŠ¥è¡¨</button>
        <button onclick="closeReportModal()" class="button">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

<!-- æ‰¹é‡ä¿®æ”¹ç»è´¹-æ¨¡æ€æ¡† -->  
<div id="batchFundsModal" class="modal">  
  <div class="modal-content">  
    <div class="modal-header">  
      <h2>æ‰¹é‡ä¿®æ”¹ç»è´¹</h2>  
      <span id="closeBatchFundsModal" style="cursor: pointer;">&times;</span>  
    </div>  
    <div class="modal-body">  
      <form id="batchFundsForm" class="search-form">  

        <!-- å¯ç”¨ä½™é¢ -->  
        <div class="form-group" style="margin-bottom: 15px;">  
          <label for="newBalance" class="form-label">æ–°çš„å¯ç”¨ä½™é¢</label>  
          <input type="number" id="newBalance" name="newBalance"   
                 placeholder="è¯·è¾“å…¥æ–°çš„å¯ç”¨ä½™é¢ï¼" required>  
        </div>  

        <!-- ç»è´¹æ¥æº -->  
        <div class="form-group" style="margin-bottom: 15px;">  
          <label for="newFundSource" class="form-label">æ–°çš„ç»è´¹æ¥æº</label>  
          <select class="form-select" id="newFundSource" name="newFundSource" required>
            <option value="">è¯·é€‰æ‹©ç»è´¹æ¥æº</option>
            <option value="æ”¯é˜Ÿç»è´¹">æ”¯é˜Ÿç»è´¹</option>
            <option value="å¤§é˜Ÿç»è´¹">å¤§é˜Ÿç»è´¹</option>
            <option value="å…¶å®ƒ">å…¶å®ƒ</option>
          </select>                 
        </div>  

      </form>  
    </div>  
    <div class="modal-footer">  
      <button class="button" id="cancelBatchFundsBtn">å–æ¶ˆ</button>  
      <button class="button" id="confirmBatchFundsBtn">ç¡®å®š</button>  
    </div>  
  </div>  
</div>  


  <script>


const pageSize = 10; // æ¯é¡µæ˜¾ç¤º10æ¡æ•°æ®  
let currentPage = 1; 
let totalPages = 1;  


    // é¡µé¢åŠ è½½æ—¶è·å–æ¶ˆé˜²å‘˜åˆ—è¡¨  
    document.addEventListener('DOMContentLoaded', function () {
      loadFirefighters();

      // å…¨é€‰/å–æ¶ˆå…¨é€‰åŠŸèƒ½  
      document.addEventListener('click', function (e) {
        if (e.target && e.target.id === 'selectAll') {
          const checkboxes = document.querySelectorAll('.row-checkbox');
          checkboxes.forEach(checkbox => {
            checkbox.checked = e.target.checked;
          });
        }
      });

      // ç›‘å¬è¡¨æ ¼ä¸­çš„checkboxå˜åŒ–  
      document.addEventListener('change', function (e) {
        if (e.target && e.target.classList.contains('row-checkbox')) {
          // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€  
          const allCheckboxes = document.querySelectorAll('.row-checkbox');
          const checkedCount = document.querySelectorAll('.row-checkbox:checked').length;
          document.getElementById('selectAll').checked = checkedCount === allCheckboxes.length && allCheckboxes.length > 0;
        }
      });


// æ‹¿åˆ°å„å…ƒç´   
const batchUpdateFundsBtn = document.getElementById('batchUpdateFundsBtn');  
const batchFundsModal = document.getElementById('batchFundsModal');  
const closeBatchFundsModal = document.getElementById('closeBatchFundsModal');  
const cancelBatchFundsBtn = document.getElementById('cancelBatchFundsBtn');  
const confirmBatchFundsBtn = document.getElementById('confirmBatchFundsBtn');  

// æ‰“å¼€æ¨¡æ€  
batchUpdateFundsBtn.addEventListener('click', () => {
    // 2. åœ¨â€œå®åŠ›ä¿¡æ¯åˆ—è¡¨â€ä¸­æ‰¾å‡ºæ‰€æœ‰é€‰ä¸­é¡¹  
  //    ä¾‹å¦‚ï¼š<input type="checkbox" class="select-checkbox" data-id="xxx" />
  const selectedIds = Array.from(document.querySelectorAll('.row-checkbox:checked'))
  .map(checkbox => checkbox.getAttribute('data-id'));

  if (selectedIds.length === 0) {  
    alert('è¯·å…ˆåœ¨åˆ—è¡¨ä¸­å‹¾é€‰è¦æ‰¹é‡ä¿®æ”¹çš„äººå‘˜ï¼');  
    return;  
  }    
  batchFundsModal.style.display = 'block';  
});  

// å…³é—­æ¨¡æ€  
function closeBatchFunds() {  
  batchFundsModal.style.display = 'none';  
  // æ¸…ç©ºè¡¨å•(å¯é€‰)  
  document.getElementById('batchFundsForm').reset();  
}  
closeBatchFundsModal.addEventListener('click', closeBatchFunds);  
cancelBatchFundsBtn.addEventListener('click', closeBatchFunds);  

// ç‚¹å‡»â€œç¡®å®šâ€ â†’ æ‰¹é‡æ›´æ–°  
confirmBatchFundsBtn.addEventListener('click', () => {  
  // 2. åœ¨â€œå®åŠ›ä¿¡æ¯åˆ—è¡¨â€ä¸­æ‰¾å‡ºæ‰€æœ‰é€‰ä¸­é¡¹  
  //    ä¾‹å¦‚ï¼š<input type="checkbox" class="select-checkbox" data-id="xxx" />
  const selectedIds = Array.from(document.querySelectorAll('.row-checkbox:checked'))
  .map(checkbox => checkbox.getAttribute('data-id'));

  if (selectedIds.length === 0) {  
    alert('è¯·å…ˆåœ¨åˆ—è¡¨ä¸­å‹¾é€‰è¦æ‰¹é‡ä¿®æ”¹çš„äººå‘˜ï¼');  
    return;  
  }  
  // 1. è·å–è¡¨å•è¾“å…¥  
  const newBalance = document.getElementById('newBalance').value.trim();  
  const newFundSource = document.getElementById('newFundSource').value;  
  if (!newBalance || !newFundSource) {  
    alert('è¯·å…ˆå¡«å†™æ–°çš„å¯ç”¨ä½™é¢å’Œé€‰æ‹©ç»è´¹æ¥æºï¼');  
    return;  
  }  

  // 3. å‘é€è¯·æ±‚åˆ°åç«¯ï¼Œè¿›è¡Œæ‰¹é‡æ›´æ–°  
  const payload = {  
    ids: selectedIds,  
    newBalance: parseFloat(parseFloat(newBalance).toFixed(2)),  
    newFundSource: newFundSource  
  };  

  fetch('/firefighters/bulkUpdateFunds', {  
    method: 'POST',  
    headers: { 'Content-Type': 'application/json' },  
    body: JSON.stringify(payload)  
  })  
    .then(res => res.json())  
    .then(result => {  
      if (result.success) {  
        alert('æ‰¹é‡æ›´æ–°ç»è´¹æˆåŠŸï¼');  
        // åˆ·æ–°é¡µé¢æˆ–é‡æ–°åŠ è½½åˆ—è¡¨  
        // e.g. loadFirefightersList();  
        loadFirefighters();
        // å…³é—­æ¨¡æ€å¹¶æ¸…ç©ºè¡¨å•  
        closeBatchFunds();  
      } else {  
        alert('æ‰¹é‡æ›´æ–°ç»è´¹å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));  
      }  
    })  
    .catch(err => {  
      console.error(err);  
      alert('è¯·æ±‚å¼‚å¸¸ï¼š' + err);  
    });  
});  


      // æ‰¹é‡åˆ é™¤æŒ‰é’®äº‹ä»¶  
      document.getElementById('batchDeleteBtn').addEventListener('click', function () {
        const selectedRows = document.querySelectorAll('.row-checkbox:checked');
        if (selectedRows.length === 0) {
          alert('è¯·å…ˆé€‰æ‹©éœ€è¦åˆ é™¤çš„äººå‘˜');
          return;
        }
        batchDeleteFirefighters();
      });

      // é‡æ–°ç»‘å®šäº‹ä»¶  
      const reportTypeElem = document.getElementById('reportType');
      if (reportTypeElem) {
        // å…ˆç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ä»¥é¿å…é‡å¤  
        reportTypeElem.removeEventListener('change', updateFilterOptions);
        // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨  
        reportTypeElem.addEventListener('change', updateFilterOptions);
        // åˆå§‹è°ƒç”¨ä¸€æ¬¡  
        updateFilterOptions();
      }


    });

    // æ‰¹é‡åˆ é™¤åŠŸèƒ½  
    function batchDeleteFirefighters() {
      const selectedIds = Array.from(document.querySelectorAll('.row-checkbox:checked'))
        .map(checkbox => checkbox.getAttribute('data-id'));

      if (selectedIds.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•');
        return;
      }

      if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedIds.length} æ¡è®°å½•å—ï¼Ÿ`)) {
        fetch('/firefighters/batch-delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ids: selectedIds })
        })
          .then(response => response.json())
          .then(result => {
            if (result.success) {
              alert(`æˆåŠŸåˆ é™¤ ${result.deletedCount} æ¡è®°å½•`);
              loadFirefighters(); // åˆ·æ–°è¡¨æ ¼  
            } else {
              alert('åˆ é™¤å¤±è´¥ï¼š' + result.error);
            }
          })
          .catch(err => {
            console.error(err);
            alert('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
          });
      }
    }


    // åŠ è½½æ¶ˆé˜²å‘˜æ•°æ®å¹¶å¡«å……è¡¨æ ¼  
    function loadFirefighters(queryParams = {}) {
      const queryString = new URLSearchParams(queryParams).toString();
      fetch('/firefighters/list?' + queryString)
        .then(response => response.json())
        .then(data => {
            const tbody = document.querySelector('#firefightersTable tbody');

            const pageInfo = document.getElementById('pageInfo');  
            const prevPageBtn = document.getElementById('prevPage');  
            const nextPageBtn = document.getElementById('nextPage');  

            // è®¡ç®—æ€»é¡µæ•°  
            totalPages = Math.ceil(data.length / pageSize);  

            // è®¡ç®—å½“å‰é¡µçš„æ•°æ®èŒƒå›´  
            const start = (currentPage - 1) * pageSize;  
            const end = start + pageSize;  
            const pageData = data.slice(start, end);

          tbody.innerHTML = ''; // æ¸…ç©ºå½“å‰è¡¨æ ¼å†…å®¹  


          pageData.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = generateTableRow(item);
            tbody.appendChild(tr);
          });
 
            // æ›´æ–°é¡µç ä¿¡æ¯  
            pageInfo.textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;  

            // æ§åˆ¶æŒ‰é’®çŠ¶æ€  
            prevPageBtn.disabled = currentPage === 1;  
            nextPageBtn.disabled = currentPage === totalPages; 
        })
        .catch(err => console.error(err));
    }
    

    function changePage(direction) {  
            currentPage += direction;  

            // ç¡®ä¿é¡µç åœ¨åˆç†èŒƒå›´å†…  
            currentPage = Math.max(1, Math.min(currentPage, totalPages));  

      const queryParams = {
        number: document.getElementById('searchNumber').value.trim(),
        name: document.getElementById('searchName').value.trim(),
        gender: document.getElementById('searchGender').value,
        ageMin: document.getElementById('searchAgeMin').value,
        ageMax: document.getElementById('searchAgeMax').value,
        position: document.getElementById('searchPosition').value.trim(),
        team: document.getElementById('searchTeam').value.trim(),
        year: document.getElementById('searchYear').value.trim(),
        // å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–æœç´¢æ¡ä»¶  
      };
      loadFirefighters(queryParams);

        }
        
        function changePage1() {  
            currentPage = 1; 
      const queryParams = {
        number: document.getElementById('searchNumber').value.trim(),
        name: document.getElementById('searchName').value.trim(),
        gender: document.getElementById('searchGender').value,
        ageMin: document.getElementById('searchAgeMin').value,
        ageMax: document.getElementById('searchAgeMax').value,
        position: document.getElementById('searchPosition').value.trim(),
        team: document.getElementById('searchTeam').value.trim(),
        year: document.getElementById('searchYear').value.trim(),
        // å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–æœç´¢æ¡ä»¶  
      };
      loadFirefighters(queryParams);             
        }  
        
        
        function changePageN(direction) {  
            currentPage = totalPages;
            
      const queryParams = {
        number: document.getElementById('searchNumber').value.trim(),
        name: document.getElementById('searchName').value.trim(),
        gender: document.getElementById('searchGender').value,
        ageMin: document.getElementById('searchAgeMin').value,
        ageMax: document.getElementById('searchAgeMax').value,
        position: document.getElementById('searchPosition').value.trim(),
        team: document.getElementById('searchTeam').value.trim(),
        year: document.getElementById('searchYear').value.trim(),
        // å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–æœç´¢æ¡ä»¶  
      };
      loadFirefighters(queryParams);            
        }          


    // ç”Ÿæˆè¡¨æ ¼è¡Œçš„HTML  
    function generateTableRow(item) {
      return `
        <td><input type="checkbox" class="row-checkbox" data-id="${item.objectId}"></td>  
        <td>${item.number}</td>  
        <td>${item.name}</td>  
        <td>${item.gender}</td>  
        <td>${item.birthDate || ''}</td>  
        <td>${item.age || ''}</td>  
        <td>${item.position || ''}</td>  
        <td>${item.team || ''}</td>  
        <td>${item.year || ''}</td>  
        <td>${item.maoleihao || ''}</td>  
        <td>${item.fuzhuanghao || ''}</td>  
        <td>${item.xieleihao || ''}</td>  
        <td>${item.shengao || ''}</td>  
        <td>${item.xiongwei || ''}</td>  
        <td>${item.yaowei || ''}</td>  
        <td>${item.touwei || ''}</td>  
        <td>${item.keyongyue || ''}</td>
        <td>${item.jingfeilaiyuan || ''}</td>           
        <td>${item.remarks || ''}</td>  
        <td>  
        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px;">  
          <button onclick="showEditFirefighterModal('${item.objectId}')" class="btn-change1">ä¿®æ”¹</button>  
          <button onclick="deleteFirefighter('${item.objectId}')" class="btn-delete1">åˆ é™¤</button>  
        </div>  
        </td> 
      `;
    }

    // åˆ é™¤æ¶ˆé˜²å‘˜ä¿¡æ¯  
    function deleteFirefighter(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¯¥å®åŠ›ä¿¡æ¯å—ï¼Ÿ')) return;

      fetch(`/firefighters/delete/${id}`, { method: 'DELETE' })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('åˆ é™¤æˆåŠŸ');
            console.log(`${id} åˆ é™¤æˆåŠŸ`);
            loadFirefighters(); // åˆ·æ–°è¡¨æ ¼  
          } else {
            alert('åˆ é™¤å¤±è´¥ï¼š' + result.error);
          }
        })
        .catch(err => console.error(err));
    }

    // æ˜¾ç¤ºæ·»åŠ æ¶ˆé˜²å‘˜çš„æ¨¡æ€çª—å£  
    function showAddFirefighterModal() {
      document.getElementById('modalTitle').innerText = 'æ·»åŠ å®åŠ›';
      clearModalForm();
      document.getElementById('firefighterId').value = ''; // æ¸…ç©ºID 
      document.getElementById('saveFirefighter').innerText = 'ç¡®è®¤æ·»åŠ '; // è®¾ç½®æŒ‰é’®æ–‡å­— 
      const numberInput = document.getElementById('modalNumber'); // è·å– DOM å…ƒç´ 
      numberInput.removeAttribute('readonly'); // ç§»é™¤ 'readonly' å±æ€§  
      document.getElementById('firefighterModal').style.display = 'block';
      document.getElementById('modalBackdrop').style.display = 'block';
    }

    // æ˜¾ç¤ºä¿®æ”¹æ¶ˆé˜²å‘˜çš„æ¨¡æ€çª—å£  
    function showEditFirefighterModal(id) {
      fetch(`/firefighters/get/${id}`)
        .then(response => response.json())
        .then(item => {
          document.getElementById('modalTitle').innerText = 'ä¿®æ”¹å®åŠ›ä¿¡æ¯';
          document.getElementById('saveFirefighter').innerText = 'ç¡®è®¤ä¿®æ”¹'; // è®¾ç½®æŒ‰é’®æ–‡å­—
          const numberInput = document.getElementById('modalNumber'); // è·å– DOM å…ƒç´ 
          numberInput.setAttribute('readonly', true); // ç¡®ä¿ç¼–å·æ¡†ä¸å¯ç¼–è¾‘ 
          fillModalForm(item);
          document.getElementById('firefighterModal').style.display = 'block';
          document.getElementById('modalBackdrop').style.display = 'block';
        })
        .catch(err => console.error(err));

    }
    // å¡«å……æ¨¡æ€çª—å£è¡¨å•æ•°æ®  
    function fillModalForm(item) {
      document.getElementById('firefighterId').value = item.objectId || '';
      document.getElementById('modalNumber').value = item.number || '';
      document.getElementById('modalName').value = item.name || '';
      document.getElementById('modalGender').value = item.gender || '';
      document.getElementById('modalBirthDate').value = item.birthDate || '';
      document.getElementById('modalAge').value = item.age || '';
      document.getElementById('modalPosition').value = item.position || '';
      document.getElementById('modalTeam').value = item.team || '';
      document.getElementById('modalYear').value = item.year || '';
      document.getElementById('modalMaoleihao').value = item.maoleihao || '';
      document.getElementById('modalFuzhuanghao').value = item.fuzhuanghao || '';
      document.getElementById('modalXieleihao').value = item.xieleihao || '';
      document.getElementById('modalShengao').value = item.shengao || '';
      document.getElementById('modalXiongwei').value = item.xiongwei || '';
      document.getElementById('modalYaowei').value = item.yaowei || '';
      document.getElementById('modalTouwei').value = item.touwei || '';
      document.getElementById('modalKeyongyue').value = item.keyongyue || '';
      document.getElementById('modalJingfeilaiyuan').value = item.jingfeilaiyuan || '';
      document.getElementById('modalRemarks').value = item.remarks || '';
    }

    // æ¸…ç©ºæ¨¡æ€çª—å£è¡¨å•æ•°æ®  
    function clearModalForm() {
      document.getElementById('firefighterForm').reset();
      // æ¸…é™¤é”™è¯¯æç¤º  
      clearErrorMessages();
    }

    // å…³é—­æ¨¡æ€çª—å£  
    document.getElementById('closeModal').onclick = function () {
      document.getElementById('firefighterModal').style.display = 'none';
      document.getElementById('modalBackdrop').style.display = 'none';
    };
    document.getElementById('cancelModal').onclick = function () {
      document.getElementById('firefighterModal').style.display = 'none';
      document.getElementById('modalBackdrop').style.display = 'none';
    };

    // ä¿å­˜æ¶ˆé˜²å‘˜ï¼ˆæ·»åŠ æˆ–ä¿®æ”¹ï¼‰  
    document.getElementById('saveFirefighter').onclick = function () {
      const id = document.getElementById('firefighterId').value;
      const form = document.getElementById('firefighterForm');
      const formData = {};
      const inputs = form.querySelectorAll('input, select');
      let valid = true;

      // æ¸…ç†ä¹‹å‰çš„é”™è¯¯æç¤º  
      clearErrorMessages();

      // 1. æå–è¡¨å•æ•°æ®å¹¶éªŒè¯  
      inputs.forEach(input => {
        if (input.required && input.value.trim() === '') {
          displayErrorMessage(input, `å­—æ®µ "${input.previousElementSibling.innerText}" æ˜¯å¿…å¡«é¡¹ï¼`);
          valid = false;
        } else {
          if (input.name === 'keyongyue') {
            formData[input.name] = parseFloat(parseFloat(input.value.trim()).toFixed(2))          
          } else {
          formData[input.name] = input.value.trim();            
          }
        }
      });

      if (!valid) return;

      let url, method;
      if (id) {
        // æ›´æ–°  
        url = `/firefighters/update/${id}`;
        method = 'PUT';
      } else {
        // æ·»åŠ   
        url = '/firefighters/add';
        method = 'POST';
      }

      fetch(url, {
        method: method,
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData),
      })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('ä¿å­˜æˆåŠŸ');
            document.getElementById('firefighterModal').style.display = 'none';
            document.getElementById('modalBackdrop').style.display = 'none';
            loadFirefighters();
          } else {
            // å¤„ç†ç¼–å·é‡å¤çš„é”™è¯¯  
            if (result.error.includes('ç¼–å·')) {
              displayErrorMessage(document.getElementById('modalNumber'), result.error);
            } else {
              alert('ä¿å­˜å¤±è´¥ï¼š' + result.error);
            }
          }
        })
        .catch(err => console.error(err));
    };

    // æ˜¾ç¤ºå­—æ®µé”™è¯¯ä¿¡æ¯  
    function displayErrorMessage(input, message) {
      input.classList.add('error'); // ç»™è¾“å…¥æ¡†åŠ é”™è¯¯æ ·å¼  
      const errorSpan = document.createElement('span');
      errorSpan.className = 'error-message';
      errorSpan.textContent = message;
      input.parentNode.appendChild(errorSpan); // åœ¨è¾“å…¥æ¡†çˆ¶å®¹å™¨ä¸­æ·»åŠ é”™è¯¯æç¤º  
    }

    // æ¸…ç†æ‰€æœ‰é”™è¯¯æç¤º  
    function clearErrorMessages() {
      const errorMessages = document.querySelectorAll('.error-message');
      errorMessages.forEach(msg => msg.remove()); // åˆ é™¤é”™è¯¯ä¿¡æ¯  
      const errorInputs = document.querySelectorAll('.error');
      errorInputs.forEach(input => input.classList.remove('error')); // ç§»é™¤é”™è¯¯æ ‡è¯†  
    }

    // æœç´¢åŠŸèƒ½  
    function searchFirefighters() {
      const queryParams = {
        number: document.getElementById('searchNumber').value.trim(),
        name: document.getElementById('searchName').value.trim(),
        gender: document.getElementById('searchGender').value,
        ageMin: document.getElementById('searchAgeMin').value,
        ageMax: document.getElementById('searchAgeMax').value,
        position: document.getElementById('searchPosition').value.trim(),
        team: document.getElementById('searchTeam').value.trim(),
        year: document.getElementById('searchYear').value.trim(),
        // å¯ä»¥ç»§ç»­æ·»åŠ å…¶ä»–æœç´¢æ¡ä»¶  
      };
      loadFirefighters(queryParams);
    }

    // é‡ç½®æœç´¢æ¡ä»¶  
    function resetSearch() {
      document.getElementById('searchForm').reset();
      loadFirefighters();
    }

    // å¯¼å…¥Excelæ–‡ä»¶è¡¨å•æäº¤  
    document.getElementById('importForm').addEventListener('submit', function (event) {
      event.preventDefault();

      const fileInput = document.getElementById('excelFile');
      const file = fileInput.files[0];
      if (!file) {
        alert('è¯·é€‰æ‹©Excelæ–‡ä»¶');
        return;
      }

      const formData = new FormData();
      formData.append('excelFile', file);

      fetch('/firefighters/import-preview', {
        method: 'POST',
        body: formData
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // æ˜¾ç¤ºæ¨¡æ€çª—å£å¹¶å±•ç¤ºé¢„è§ˆæ•°æ®  
            showImportModal(data.previewData);
          } else {
            alert('é¢„è§ˆå¤±è´¥ï¼š' + data.error);
          }
        })
        .catch(err => console.error(err));
    });

    // æ˜¾ç¤ºå¯¼å…¥æ¨¡æ€çª—å£  
    function showImportModal(previewData) {
      const modal = document.getElementById('importModal');
      const closeModalBtn = document.getElementById('closeImportModal');
      const confirmBtn = document.getElementById('confirmImport');
      const cancelBtn = document.getElementById('cancelImport');
      const previewTable = document.getElementById('importPreviewTable');

      // æ¸…ç©ºé¢„è§ˆè¡¨æ ¼å†…å®¹  
      previewTable.innerHTML = '';

      if (previewData.length === 0) {
        previewTable.innerHTML = '<p>æ²¡æœ‰å¯é¢„è§ˆçš„æ•°æ®ã€‚</p>';
        return;
      }

      // åŠ¨æ€ç”Ÿæˆè¡¨æ ¼å¤´  
      const headers = Object.keys(previewData[0]);
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      previewTable.appendChild(thead);

      // åŠ¨æ€ç”Ÿæˆè¡¨æ ¼ä½“  
      const tbody = document.createElement('tbody');
      previewData.forEach(item => {
        const tr = document.createElement('tr');
        headers.forEach(header => {
          const td = document.createElement('td');
          td.textContent = item[header] !== undefined ? item[header] : '';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      previewTable.appendChild(tbody);

      // æ˜¾ç¤ºæ¨¡æ€çª—å£  
      modal.style.display = 'block';

      // å…³é—­æ¨¡æ€çª—å£äº‹ä»¶  
      closeModalBtn.onclick = () => {
        modal.style.display = 'none';
      };
      cancelBtn.onclick = () => {
        modal.style.display = 'none';
      };

      // ç¡®è®¤å¯¼å…¥äº‹ä»¶  
      confirmBtn.onclick = () => {
        fetch('/firefighters/import-confirm', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data: previewData })
        })
          .then(response => response.json())
          .then(result => {
            if (result.success) {
              // æ„å»ºè¯¦ç»†åé¦ˆä¿¡æ¯  
              const message = `  
                å¯¼å…¥å®Œæˆï¼š  
                æˆåŠŸå¯¼å…¥ï¼š${result.saved} æ¡è®°å½•ã€‚  
                è·³è¿‡ï¼š${result.skipped} æ¡è®°å½•ã€‚  
              `;

              // æ˜¾ç¤ºè·³è¿‡è®°å½•è¯¦æƒ…  
              if (result.skipped > 0) {
                const skippedDetails = result.details.skipped.map(item => {
                  return `ç¼–å·: ${item.data.number || 'æœªçŸ¥'}, åŸå› : ${item.reason}`;
                }).join('\n');

                alert(`${message}\nè·³è¿‡è¯¦æƒ…ï¼š\n${skippedDetails}`);
              } else {
                alert(message);
              }

              // éšè—æ¨¡æ€çª—å£ï¼Œé‡æ–°åŠ è½½åˆ—è¡¨  
              modal.style.display = 'none';
              loadFirefighters(); // è°ƒç”¨ç°æœ‰çš„åˆ—è¡¨åŠ è½½é€»è¾‘  
            } else {
              alert('å¯¼å…¥å¤±è´¥ï¼š' + result.error);
            }
          })
          .catch(err => console.error('å¯¼å…¥è¯·æ±‚å¤±è´¥ï¼š', err));
      };
    }

    // ç‚¹å‡»æ¨¡æ€çª—å£å¤–éƒ¨å…³é—­æ¨¡æ€çª—å£  
    window.onclick = function (event) {
      const firefighterModal = document.getElementById('firefighterModal');
      const importModal = document.getElementById('importModal');
      if (event.target == firefighterModal) {
        firefighterModal.style.display = 'none';
        document.getElementById('modalBackdrop').style.display = 'none';
      }
      if (event.target == importModal) {
        importModal.style.display = 'none';
      }
    };

    // è·å–å‡ºç”Ÿæ—¥æœŸè¾“å…¥æ¡†  
    const birthDateInput = document.getElementById("modalBirthDate");
    // è·å–å¹´é¾„è¾“å…¥æ¡†  
    const ageInput = document.getElementById("modalAge");

    // æ³¨å†Œç›‘å¬äº‹ä»¶ï¼šå½“æ—¥æœŸå‘ç”Ÿå˜åŠ¨æ—¶  
    birthDateInput.addEventListener("change", () => {
      const birthDateValue = birthDateInput.value; // å½¢å¦‚ "2023-03-05"  

      if (!birthDateValue) {
        // æ¸…ç©ºæˆ–ä¿ç•™  
        ageInput.value = "";
        return;
      }

      const birthDate = new Date(birthDateValue);
      if (isNaN(birthDate)) {
        // éæ³•æ—¥æœŸï¼ˆç†è®ºä¸Šä¸å¤ªä¼šå‘ç”Ÿï¼Œä½†å¯åšé˜²å¾¡æ€§å¤„ç†ï¼‰  
        ageInput.value = "";
        return;
      }

      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();

      // è®¡ç®—æ˜¯å¦è¿‡äº†ç”Ÿæ—¥ï¼ˆæœˆä»½æˆ–æ—¥æœŸï¼‰  
      const monthDiff = today.getMonth() - birthDate.getMonth();
      const dayDiff = today.getDate() - birthDate.getDate();
      if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
        age--;
      }

      // è‹¥å¹´é¾„å°äº0ï¼Œå¯æ ¹æ®éœ€è¦è®¾ä¸º0æˆ–ç©ºå­—ç¬¦ä¸²  
      if (age < 0) {
        age = 0;
      }

      // å†™å›åˆ°å¹´é¾„è¾“å…¥æ¡†  
      ageInput.value = age;
    });


    // æ˜¾ç¤ºå•ä½å˜æ›´æ¨¡æ€çª—å£  
    function showChangeTeamModal() {
      const selectedRows = document.querySelectorAll('.row-checkbox:checked');
      if (selectedRows.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©éœ€è¦å˜æ›´å•ä½çš„äººå‘˜');
        return;
      }

      // è·å–é€‰ä¸­è¡Œçš„æ•°æ®  
      const selectedIds = Array.from(selectedRows).map(checkbox => checkbox.getAttribute('data-id'));
      fetchSelectedFirefighters(selectedIds);
    }

    // è·å–é€‰ä¸­çš„æ¶ˆé˜²å‘˜æ•°æ®  
    function fetchSelectedFirefighters(ids) {
      Promise.all(ids.map(id =>
        fetch(`/firefighters/get/${id}`)
          .then(response => response.json())
      ))
        .then(firefighters => {
          displayChangeTeamTable(firefighters);
          document.getElementById('changeTeamModal').style.display = 'block';
          document.getElementById('modalBackdrop').style.display = 'block';
        })
        .catch(err => {
          console.error(err);
          alert('è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        });
    }

    // æ˜¾ç¤ºå˜æ›´å•ä½è¡¨æ ¼  
    function displayChangeTeamTable(firefighters) {
      const tbody = document.querySelector('#changeTeamTable tbody');
      tbody.innerHTML = '';

      firefighters.forEach(item => {
        const tr = document.createElement('tr');
        tr.setAttribute('data-id', item.objectId);

        // åˆ›å»ºå•ä½é€‰æ‹©ä¸‹æ‹‰èœå•  
        const teamSelect = `  
      <select class="form-select new-team">  
                <option value="">è¯·é€‰æ‹©å•ä½</option>
                <option value="é˜²ç«æˆ˜çº¿">é˜²ç«æˆ˜çº¿</option>  
                <option value="ç­ç«æˆ˜çº¿">ç­ç«æˆ˜çº¿</option>  
                <option value="æ”¿æ²»éƒ¨æˆ˜çº¿">æ”¿æ²»éƒ¨æˆ˜çº¿</option>  
                <option value="åå‹¤æˆ˜çº¿">åå‹¤æˆ˜çº¿</option>  
                <option value="æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™">æŒ‡æŒ¥ä¸­å¿ƒå’Œå‹¤åŠ¡ç«™</option>  
                <option value="æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ">æˆ˜å‹¤ä¿éšœå¤§é˜Ÿ</option>  
                <option value="ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç™½å¡”åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™">é“è¥¿è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">æ–‡åœ£åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™">å®‰åº·è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™">æ–‡æ˜Œè¡—æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¤ªå­æ²³åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="è”¡å››è·¯ç‰¹å‹¤ç«™">è”¡å››è·¯ç‰¹å‹¤ç«™</option>  
                <option value="è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">è¾½é˜³å¿æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™">ä¸‹è¾¾æ²³æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">åˆ˜äºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™">é»„æ³¥æ´¼æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">ç¯å¡”å¸‚æ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™">ä½ŸäºŒå ¡æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="é“§å­æ¶ˆé˜²æ•‘æ´ç«™">é“§å­æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å®ä¼ŸåŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™">ä¸‡å’Œä¸€è·¯æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ">å¼“é•¿å²­åŒºæ¶ˆé˜²æ•‘æ´å¤§é˜Ÿ</option>  
                <option value="æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™">æ±¤æ³‰è°·æ¶ˆé˜²æ•‘æ´ç«™</option>  
                <option value="å…¶å®ƒ">å…¶å®ƒ</option>
      </select>  
    `;

        tr.innerHTML = `  
      <td>${item.number || ''}</td>  
      <td>${item.name || ''}</td>  
      <td>${item.gender || ''}</td>  
      <td>${item.age || ''}</td>  
      <td>${item.team || ''}</td>  
      <td>${teamSelect}</td>  
      <td><button class="remove-row button-secondary">åˆ é™¤</button></td>  
    `;

        tbody.appendChild(tr);
      });

      // ç»‘å®šåˆ é™¤è¡ŒæŒ‰é’®äº‹ä»¶  
      document.querySelectorAll('.remove-row').forEach(button => {
        button.addEventListener('click', function () {
          this.closest('tr').remove();
        });
      });
    }

    // å…³é—­æ¨¡æ€çª—å£  
    document.getElementById('closeChangeTeamModal').addEventListener('click', function () {
      document.getElementById('changeTeamModal').style.display = 'none';
      document.getElementById('modalBackdrop').style.display = 'none';
    });

    document.getElementById('cancelChangeTeam').addEventListener('click', function () {
      document.getElementById('changeTeamModal').style.display = 'none';
      document.getElementById('modalBackdrop').style.display = 'none';
    });

    // æäº¤å•ä½å˜æ›´  
    document.getElementById('submitChangeTeam').addEventListener('click', function () {
      const rows = document.querySelectorAll('#changeTeamTable tbody tr');
      const changes = [];
      const updates = [];

      // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®  
      if (rows.length === 0) {
        alert('æ²¡æœ‰éœ€è¦å˜æ›´çš„æ•°æ®');
        return;
      }

      // æ”¶é›†å˜æ›´æ•°æ®  
      rows.forEach(row => {
        const id = row.getAttribute('data-id');
        const number = row.cells[0].textContent;
        const name = row.cells[1].textContent;
        const gender = row.cells[2].textContent;
        const age = row.cells[3].textContent;
        const oldTeam = row.cells[4].textContent;
        const newTeam = row.cells[5].querySelector('select').value;

        // éªŒè¯æ–°å•ä½æ˜¯å¦å·²é€‰æ‹©  
        if (!newTeam) {
          alert('è¯·ä¸ºæ‰€æœ‰äººå‘˜é€‰æ‹©å˜æ›´å•ä½');
          throw new Error('å˜æ›´å•ä½æœªé€‰æ‹©');
        }

        // åˆ›å»ºå˜æ›´è®°å½•  
        changes.push({
          number,
          name,
          gender,
          age,
          oldTeam,
          newTeam,
          changeDate: new Date().toISOString().split('T')[0]
        });

        // åˆ›å»ºæ›´æ–°è®°å½•  
        updates.push({
          id,
          team: newTeam
        });
      });

      // æäº¤å˜æ›´  
      saveTeamChanges(changes, updates);
    });

    // ä¿å­˜å•ä½å˜æ›´  
    function saveTeamChanges(changes, updates) {
      // 1. æ›´æ–°Firefighterè¡¨ä¸­çš„å•ä½  
      fetch('/firefighters/batch-update-team', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ updates })
      })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            // 2. å°†å˜æ›´è®°å½•ä¿å­˜åˆ°Changeè¡¨  
            return fetch('/changes/add', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ changes })
            });
          } else {
            throw new Error('æ›´æ–°å•ä½å¤±è´¥ï¼š' + result.error);
          }
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('å•ä½å˜æ›´æˆåŠŸ');
            document.getElementById('changeTeamModal').style.display = 'none';
            document.getElementById('modalBackdrop').style.display = 'none';
            loadFirefighters(); // åˆ·æ–°è¡¨æ ¼  
          } else {
            alert('ä¿å­˜å˜æ›´è®°å½•å¤±è´¥ï¼š' + result.error);
          }
        })
        .catch(err => {
          console.error(err);
          alert('æ“ä½œå¤±è´¥ï¼š' + (err.message || 'æœªçŸ¥é”™è¯¯'));
        });
    }


    // æ˜¾ç¤ºæŠ¥è¡¨æ¨¡æ€çª—å£  
    function showReportModal() {
      document.getElementById('reportModal').style.display = 'block';
      document.getElementById('modalBackdrop').style.display = 'block';

      // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºå½“å‰æœˆä»½çš„ç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©  
      const now = new Date();
      const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
      const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);

      document.getElementById('startDate').valueAsDate = firstDay;
      document.getElementById('endDate').valueAsDate = lastDay;

    }


    // æ‰“å°å½“å‰å®åŠ›  
    function printnow() {
  
      const printoutputFormatElement = document.querySelector('input[name="printoutputFormat"]:checked').value;

      // åŸºæœ¬å‚æ•° - ä¿®æ”¹ä¸ºæ­£ç¡®çš„å‚æ•°å  
      const params = {
        reportType: 'shilixinxi'  // æ­£ç¡®çš„å‚æ•°å  
      };

      params.number = document.getElementById('searchNumber').value;      
      params.name = document.getElementById('searchName').value;
      params.gender = document.getElementById('searchGender').value;
      params.ageMin = document.getElementById('searchAgeMin').value;
      params.ageMax = document.getElementById('searchAgeMax').value;
      params.position = document.getElementById('searchPosition').value;
      params.team = document.getElementById('searchTeam').value;
      params.yearMinMax = document.getElementById('searchYear').value;

      // æ·»åŠ æ’åºå‚æ•°  
      params.sortField = '';
      params.sortOrder = '';

      // è¯·æ±‚æŠ¥è¡¨æ•°æ®  
      fetch('/reports/generatenow?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            if (printoutputFormatElement === 'print') {
              displayPrintableReport(data.report, params.reportType);
            } else if (printoutputFormatElement === 'pdf') {
              downloadReportPDF(data.report, params.reportType);
            } else if (printoutputFormatElement === 'excel') {
              downloadReportExcel(data.report, params.reportType);
            }
          } else {
            alert('ç”ŸæˆæŠ¥è¡¨å¤±è´¥ï¼š' + data.error);
          }
        })
        .catch(err => {
          console.error('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥:', err);
          alert('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        });
    }


// æ‰“å°æ‰€æœ‰å®åŠ›  
function printall() {
  
  const printoutputFormatElement = document.querySelector('input[name="printoutputFormat"]:checked').value;

  // åŸºæœ¬å‚æ•° - ä¿®æ”¹ä¸ºæ­£ç¡®çš„å‚æ•°å  
  const params = {
    reportType: 'shilixinxi'  // æ­£ç¡®çš„å‚æ•°å  
  };

  // æ·»åŠ æ’åºå‚æ•°  
  params.sortField = '';
  params.sortOrder = '';

  // è¯·æ±‚æŠ¥è¡¨æ•°æ®  
  fetch('/reports/generateall?' + new URLSearchParams(params))
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        if (printoutputFormatElement === 'print') {
          displayPrintableReport(data.report, params.reportType);
        } else if (printoutputFormatElement === 'pdf') {
          downloadReportPDF(data.report, params.reportType);
        } else if (printoutputFormatElement === 'excel') {
          downloadReportExcel(data.report, params.reportType);
        }
      } else {
        alert('ç”ŸæˆæŠ¥è¡¨å¤±è´¥ï¼š' + data.error);
      }
    })
    .catch(err => {
      console.error('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥:', err);
      alert('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    });
}

    // å…³é—­æŠ¥è¡¨æ¨¡æ€çª—å£  
    function closeReportModal() {
      document.getElementById('reportModal').style.display = 'none';
      document.getElementById('modalBackdrop').style.display = 'none';
    }

    // æ ¹æ®é€‰æ‹©çš„æŠ¥è¡¨ç±»å‹æ˜¾ç¤ºä¸åŒçš„ç­›é€‰é€‰é¡¹  
    function updateFilterOptions() {
      const reportTypeElement = document.getElementById('reportType').value;

      // éšè—æ‰€æœ‰ç­›é€‰ç»„  
      document.querySelectorAll('.filter-group').forEach(elem => {
        elem.style.display = 'none';
      });

      // æ˜¾ç¤ºå¯¹åº”æŠ¥è¡¨ç±»å‹çš„ç­›é€‰ç»„  
      switch (reportTypeElement) {
        case 'personnel':
          document.getElementById('personnelFilters').style.display = 'block';
          updateSortOptions(['number', 'name', 'ageNum', 'team', 'year']);
          break;
        case 'equipment':
          document.getElementById('equipmentFilters').style.display = 'block';
          updateSortOptions(['number', 'name', 'team']);
          break;
        case 'bodySize':
          document.getElementById('bodySizeFilters').style.display = 'block';
          updateSortOptions(['number', 'name', 'shengaoNum', 'xiongweiNum', 'yaoweiNum', 'touweiNum']);
          break;
        case 'teamSummary':
          // é˜Ÿä¼äººå‘˜ç»Ÿè®¡è¡¨ä¸éœ€è¦é¢å¤–ç­›é€‰  
          updateSortOptions(['team', 'total', 'male', 'female', 'avgAge']);
          break;
        case 'changeHistory':
          document.getElementById('changeHistoryFilters').style.display = 'block';
          updateSortOptions(['changeDate', 'number', 'name', 'oldTeam', 'newTeam']);
          break;
      }
    }

    // æ›´æ–°æ’åºå­—æ®µé€‰é¡¹  
    function updateSortOptions(fields) {
      const sortField = document.getElementById('sortField');

      // æ¸…ç©ºç°æœ‰é€‰é¡¹  
      sortField.innerHTML = '<option value="">é»˜è®¤æ’åº</option>';

      // æ·»åŠ æŠ¥è¡¨ç‰¹å®šçš„æ’åºå­—æ®µ  
      const fieldNames = {
        'number': 'ç¼–å·',
        'name': 'å§“å',
        'sex': 'æ€§åˆ«',
        'bornyear': 'å‡ºç”Ÿå¹´æœˆ',        
        'ageNum': 'å¹´é¾„',
        'position': 'èŒåŠ¡',
        'team': 'å•ä½',
        'year': 'å·¥ä½œå¹´é™',
        'maoleiNum': 'å¸½ç±»å·',
        'fuzhuangNum': 'æœè£…å·',
        'xieleiNum': 'é‹ç±»å·',        
        'shengaoNum': 'èº«é«˜',
        'xiongweiNum': 'èƒ¸å›´',
        'yaoweiNum': 'è…°å›´',
        'touweiNum': 'å¤´å›´',
        'keyongyue': 'å¯ç”¨ä½™é¢',
        'jingfeilaiyuan': 'ç»è´¹æ¥æº',
        'beizhu': 'å¤‡æ³¨',
        'total': 'æ€»äººæ•°',
        'male': 'ç”·æ€§äººæ•°',
        'female': 'å¥³æ€§äººæ•°',
        'avgAge': 'å¹³å‡å¹´é¾„',
        'changeDate': 'å˜æ›´æ—¥æœŸ',
        'oldTeam': 'åŸå•ä½',
        'newTeam': 'å˜æ›´å•ä½'
      };

      fields.forEach(field => {
        const option = document.createElement('option');
        option.value = field;
        option.textContent = fieldNames[field] || field;
        sortField.appendChild(option);
      });
    }

    // ç”ŸæˆæŠ¥è¡¨æ—¶æ”¶é›†æ‰€æœ‰ç­›é€‰æ¡ä»¶  
    function generateReport() {
      const reportTypeElement = document.getElementById('reportType').value;
      const teamFilterElement = document.getElementById('teamFilter').value;
      const outputFormatElement = document.querySelector('input[name="outputFormat"]:checked').value;

      // åŸºæœ¬å‚æ•° - ä¿®æ”¹ä¸ºæ­£ç¡®çš„å‚æ•°å  
      const params = {
        reportType: reportTypeElement,  // æ­£ç¡®çš„å‚æ•°å  
        teamFilter: teamFilterElement   // æ­£ç¡®çš„å‚æ•°å  
      };

      // æ ¹æ®æŠ¥è¡¨ç±»å‹æ”¶é›†ç‰¹å®šç­›é€‰æ¡ä»¶  
      switch (reportTypeElement) {
        case 'personnel':
          params.gender = document.getElementById('genderFilter').value;
          params.ageMin = document.getElementById('ageMin').value;
          params.ageMax = document.getElementById('ageMax').value;
          params.position = document.getElementById('positionFilter').value;
          params.yearMin = document.getElementById('yearMinFilter').value;
          params.yearMax = document.getElementById('yearMaxFilter').value;
          break;
        case 'equipment':
          params.gender = document.getElementById('genderFilter').value;
          params.hatSize = document.getElementById('hatSizeFilter').value;
          params.clothingSize = document.getElementById('clothingSizeFilter').value;
          params.shoeSize = document.getElementById('shoeSizeFilter').value;
          break;
        case 'bodySize':
          params.gender = document.getElementById('genderFilter').value;
          params.heightMin = document.getElementById('heightMin').value;
          params.heightMax = document.getElementById('heightMax').value;
          params.chestMin = document.getElementById('chestMin').value;
          params.chestMax = document.getElementById('chestMax').value;
          params.waistMin = document.getElementById('waistMin').value;
          params.waistMax = document.getElementById('waistMax').value;
          params.headMin = document.getElementById('headMin').value;
          params.headMax = document.getElementById('headMax').value;
          break;
        case 'changeHistory':
          params.startDate = document.getElementById('startDate').value;
          params.endDate = document.getElementById('endDate').value;
          params.oldTeam = document.getElementById('oldTeamFilter').value;
          break;
      }

      // æ·»åŠ æ’åºå‚æ•°  
      params.sortField = document.getElementById('sortField').value;
      params.sortOrder = document.getElementById('sortOrder').value;

      // è¯·æ±‚æŠ¥è¡¨æ•°æ®  
      fetch('/reports/generate?' + new URLSearchParams(params))
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            if (outputFormatElement === 'print') {
              displayPrintableReport(data.report, reportTypeElement);
            } else if (outputFormatElement === 'pdf') {
              downloadReportPDF(data.report, reportTypeElement);
            } else if (outputFormatElement === 'excel') {
              downloadReportExcel(data.report, reportTypeElement);
            }
          } else {
            alert('ç”ŸæˆæŠ¥è¡¨å¤±è´¥ï¼š' + data.error);
          }
        })
        .catch(err => {
          console.error('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥:', err);
          alert('æŠ¥è¡¨ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        });

      // å…³é—­æ¨¡æ€çª—å£  
      closeReportModal();
    }

    // æ˜¾ç¤ºå¯æ‰“å°çš„æŠ¥è¡¨  
    function displayPrintableReport(report, reportType) {
      // åˆ›å»ºæ‰“å°å®¹å™¨  
      const printContainer = document.createElement('div');
      printContainer.className = 'print-container';
      printContainer.id = 'printableReport';

      // æ·»åŠ æŠ¥è¡¨å¤´éƒ¨  
      const header = document.createElement('div');
      header.className = 'print-header';
      header.innerHTML = `  
    <h11 style="font-size: 40px;">${getReportTitle(reportType)}</h11>  
  `;
      printContainer.appendChild(header);

      // æ·»åŠ æŠ¥è¡¨å†…å®¹  
      const content = document.createElement('div');
      content.className = 'print-content';
      content.innerHTML = generateReportTable(report, reportType);
      printContainer.appendChild(content);

      // æ·»åŠ æ‰“å°ä¿¡æ¯ï¼ˆæ”¾åœ¨è¡¨æ ¼ä¸‹æ–¹ï¼‰  
      const printInfo = document.createElement('div');
      printInfo.className = 'print-info';

      // ä» EJS å˜é‡ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·å  
      const username = currentUser.username; // å‡è®¾å·²ä»åç«¯ä¼ é€’åˆ°å…¨å±€å˜é‡

      // å‘èµ·è¯·æ±‚æŸ¥è¯¢
      fetch(`/gerenxinxiguanli/fetch?number=${username}`)
        .then(res => res.json())
        .then(result => {
          if (result.success) {
            // å­˜åœ¨è®°å½•ï¼Œè‡ªåŠ¨å¡«å……è¡¨å•  
            const data = result.data;
            if (currentUser && data.name) {
              printInfo.innerHTML = `  
    <div class="print-info-container" style="display: flex; gap: 30px;">  
      <div class="print-date">æ‰“å°æ—¥æœŸï¼š${new Date().toLocaleDateString()}</div>  
      <div class="print-user">æ‰“å°äººï¼š${data.name || 'ç³»ç»Ÿç®¡ç†å‘˜'}</div>  
    </div>  
  `;
              printContainer.appendChild(printInfo);
              return;
            }
          }
        });

      // æ·»åŠ æŠ¥è¡¨åº•éƒ¨ï¼ˆä»…åŒ…å«æ“ä½œæŒ‰é’®ï¼‰  
      const footer = document.createElement('div');
      footer.className = 'print-footer';
      footer.innerHTML = `  
    <div class="no-print action-buttons">  
      <button onclick="printReportIframe()" class="button">æ‰“å°æ­¤é¡µ</button>  
      <button onclick="closeReport()" class="button button-secondary">å…³é—­</button>  
    </div>  
  `;
      printContainer.appendChild(footer);

      // æ·»åŠ å¿…è¦çš„æ ·å¼  
      const style = document.createElement('style');
      style.textContent = `  
  .action-buttons {  
    display: flex !important;  
    justify-content: flex-end !important;  
    gap: 10px;  
    width: 100%;  
  }  
  
  /* é‡ç½®å¯èƒ½å½±å“å¯¹é½çš„æ ·å¼ */  
  .print-footer {  
    width: 100%;  
    box-sizing: border-box;  
  }  
  
  .no-print {  
    width: 100%;  
  }  
`;
      document.head.appendChild(style);


      // æ·»åŠ åˆ°æ–‡æ¡£ä¸­  
      document.body.appendChild(printContainer);
    }


// ä½¿ç”¨iframeæ‰“å°å¹¶å¼ºåˆ¶æ’å…¥é¡µç 
function printReportIframe() {
  // è·å–è¦æ‰“å°çš„å†…å®¹  
  const printContent = document.getElementById('printableReport');
  
  // è·å–æ ‡é¢˜
  const reportTitle = printContent.querySelector('.print-header h11')?.textContent || 'æŠ¥è¡¨';

  // åˆ›å»ºä¸€ä¸ªæ–°çš„iframe  
  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  document.body.appendChild(iframe);

  // è·å–è¡¨æ ¼å’Œå…¶å†…å®¹
  const table = printContent.querySelector('table');
  if (!table) {
    console.error('æ‰¾ä¸åˆ°è¡¨æ ¼å…ƒç´ ');
    return;
  }

  const thead = table.querySelector('thead');
  const tbody = table.querySelector('tbody');
  
  if (!thead || !tbody) {
    console.error('è¡¨æ ¼ç»“æ„ä¸å®Œæ•´');
    return;
  }

  // è·å–è¡¨å¤´HTML
  const theadHTML = thead.outerHTML;
  
  // è·å–æ‰€æœ‰è¡Œ
  const rows = Array.from(tbody.querySelectorAll('tr'));
   
  // è·å–æ ‡é¢˜å’Œå…¶ä»–ä¿¡æ¯
  const headerHTML = printContent.querySelector('.print-header')?.outerHTML || '';
  const printInfoHTML = printContent.querySelector('.print-info')?.outerHTML || '';
  
 let rowsPerPage = 10;
  
  // è®¡ç®—æ€»é¡µæ•°
  const totalPages = Math.ceil(rows.length / rowsPerPage);
  
  // åˆ›å»ºåˆ†é¡µåçš„å†…å®¹
  let pagedContent = '';
 
  // ä¸ºæ¯é¡µåˆ›å»ºå†…å®¹
  for (let page = 0; page < totalPages; page++) {
    // å½“å‰é¡µçš„è¡ŒèŒƒå›´
    const startRow = page * rowsPerPage;
    const endRow = Math.min((page + 1) * rowsPerPage, rows.length);
    
    // æå–å½“å‰é¡µçš„è¡Œ
    const pageRows = rows.slice(startRow, endRow);
    const pageRowsHTML = pageRows.map(row => row.outerHTML).join('');
    
    // åˆ›å»ºå½“å‰é¡µçš„è¡¨æ ¼
    const pageTableHTML = `
      <table>
        ${theadHTML}
        <tbody>
          ${pageRowsHTML}
        </tbody>
      </table>
    `;
    
    // åˆ›å»ºå½“å‰é¡µçš„å®Œæ•´å†…å®¹
    pagedContent += `
      <div class="page">
        ${headerHTML}
        ${pageTableHTML}
        ${page === totalPages - 1 ? printInfoHTML : ''}
        <div class="page-number">ç¬¬ ${page + 1} é¡µ/å…± ${totalPages} é¡µ</div>
      </div>
    `;
  }
  
  // è·å–iframeçš„æ–‡æ¡£  
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  
  // å†™å…¥åŸºæœ¬HTMLç»“æ„ï¼ŒåŒ…æ‹¬åˆ†é¡µåçš„å†…å®¹
  iframeDoc.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>${reportTitle}</title>
      <style>
        /* é‡ç½®æ ·å¼ */
        body, html {
          margin: 0;
          padding: 0;
          font-family: Arial, sans-serif;
        }
        
        /* é¡µé¢æ ·å¼ */
        .page {  
          position: relative;  
          padding: 10mm;  
          box-sizing: border-box;  
        }  
        @media print {  
          @page { margin: 0; }  
          .page { page-break-after: always; }  
          .page:last-child { page-break-after: avoid; }
          
          html {
            zoom: 0.8; /* æ•´ä½“ç¼©æ”¾åˆ°80% */
          }
          
        }  
        
        /* æŠ¥è¡¨æ ·å¼ */
        .print-header {
          text-align: center;
          margin-bottom: 5mm;
        }
        
        /* æ‰“å°ä¿¡æ¯æ ·å¼ */
        .print-info {
          padding: 0;
          margin-top: 5mm;
        }
        
        .print-info-container {
          display: flex;
          justify-content: space-between;
          border-top: 1px solid #ddd;
          padding-top: 5mm;
        }
        
        .print-date, .print-user {
          font-size: 10pt;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 10mm;
        }
        
        th, td {
          border: 1px solid #333;
          padding: 3mm;
          text-align: center;
        }
        
        th {
          background-color: #f2f2f2;
        }
        
        /* é¡µç æ ·å¼ */
        .page-number {
          position: absolute;
          bottom: 5mm;
          left: 0;
          width: 100%;
          text-align: center;
          font-size: 10pt;
        }
        
      </style>
    </head>
    <body>
      ${pagedContent}
    </body>
    </html>
  `);
  
  iframeDoc.close();
  
  // ç­‰å¾…å†…å®¹åŠ è½½å®Œæˆ  
  setTimeout(() => {
    // æ‰“å°iframeå†…å®¹  
    iframe.contentWindow.focus();
    iframe.contentWindow.print();
    
    // æ‰“å°ååˆ é™¤iframe  
    setTimeout(() => {
      document.body.removeChild(iframe);
    }, 1000);
  }, 1000);
}


    // å…³é—­æŠ¥è¡¨  
    function closeReport() {
      const container = document.getElementById('printableReport');
      if (container) {
        document.body.removeChild(container);
      }
    }

    // è·å–æŠ¥è¡¨æ ‡é¢˜  
    function getReportTitle(reportType) {
      const titles = {
        'personnel': 'äººå‘˜åŸºæœ¬ä¿¡æ¯è¡¨',
        'equipment': 'äººå‘˜è£…å¤‡é…å‘è¡¨',
        'bodySize': 'äººå‘˜ä½“å‹å°ºå¯¸è¡¨',
        'teamSummary': 'é˜Ÿä¼äººå‘˜ç»Ÿè®¡è¡¨',
        'changeHistory': 'å•ä½å˜æ›´è®°å½•è¡¨',
        'shilixinxi': 'å®åŠ›ä¿¡æ¯ç»Ÿè®¡è¡¨'

      };
      return titles[reportType] || 'æŠ¥è¡¨';
    }

    // ç”ŸæˆæŠ¥è¡¨è¡¨æ ¼HTML  
    function generateReportTable(report, reportType) {
      let tableHTML = '<table class="print-table">';

      // æ ¹æ®æŠ¥è¡¨ç±»å‹ç”Ÿæˆä¸åŒçš„è¡¨å¤´  
      if (reportType === 'personnel') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>ç¼–å·</th>  
          <th>å§“å</th>  
          <th>æ€§åˆ«</th>  
          <th>å¹´é¾„</th>  
          <th>èŒåŠ¡</th>  
          <th>å•ä½</th>  
          <th>å·¥ä½œå¹´é™</th>  
          <th>å¯ç”¨ä½™é¢</th>
          <th>ç»è´¹æ¥æº</th>            
          <th>å¤‡æ³¨</th>  
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.number || ''}</td>  
          <td>${item.name || ''}</td>  
          <td>${item.gender || ''}</td>  
          <td>${item.age || ''}</td>  
          <td>${item.position || ''}</td>  
          <td>${item.team || ''}</td>  
          <td>${item.year || ''}</td>  
          <td>${item.keyongyue || ''}</td>
          <td>${item.jingfeilaiyuan || ''}</td>            
          <td>${item.remarks || ''}</td>  
        </tr>  
      `;
        });

      } else if (reportType === 'equipment') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>ç¼–å·</th>  
          <th>å§“å</th>  
          <th>æ€§åˆ«</th>  
          <th>å•ä½</th>  
          <th>å¸½ç±»å·</th>  
          <th>æœè£…å·</th>  
          <th>é‹ç±»å·</th>  
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.number || ''}</td>  
          <td>${item.name || ''}</td>  
          <td>${item.gender || ''}</td>  
          <td>${item.team || ''}</td>  
          <td>${item.maoleihao || ''}</td>  
          <td>${item.fuzhuanghao || ''}</td>  
          <td>${item.xieleihao || ''}</td>  
        </tr>  
      `;
        });

      } else if (reportType === 'bodySize') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>ç¼–å·</th>  
          <th>å§“å</th>  
          <th>æ€§åˆ«</th>  
          <th>å•ä½</th>  
          <th>èº«é«˜(CM)</th>  
          <th>èƒ¸å›´(CM)</th>  
          <th>è…°å›´(CM)</th>  
          <th>å¤´å›´(CM)</th>  
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.number || ''}</td>  
          <td>${item.name || ''}</td>  
          <td>${item.gender || ''}</td>  
          <td>${item.team || ''}</td>  
          <td>${item.shengao || ''}</td>  
          <td>${item.xiongwei || ''}</td>  
          <td>${item.yaowei || ''}</td>  
          <td>${item.touwei || ''}</td>  
        </tr>  
      `;
        });

      } else if (reportType === 'teamSummary') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>å•ä½</th>  
          <th>æ€»äººæ•°</th>  
          <th>ç”·æ€§</th>  
          <th>å¥³æ€§</th>  
          <th>å¹³å‡å¹´é¾„</th>  
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.team || ''}</td>  
          <td>${item.total || 0}</td>  
          <td>${item.male || 0}</td>  
          <td>${item.female || 0}</td>  
          <td>${item.avgAge || 0}</td>  
        </tr>  
      `;
        });

      } else if (reportType === 'changeHistory') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>ç¼–å·</th>  
          <th>å§“å</th>  
          <th>æ€§åˆ«</th>  
          <th>å¹´é¾„</th>  
          <th>åŸå•ä½</th>  
          <th>å˜æ›´å•ä½</th>  
          <th>å˜æ›´æ—¥æœŸ</th>  
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.number || ''}</td>  
          <td>${item.name || ''}</td>  
          <td>${item.gender || ''}</td>  
          <td>${item.age || ''}</td>  
          <td>${item.oldTeam || ''}</td>  
          <td>${item.newTeam || ''}</td>  
          <td>${item.changeDate || ''}</td>  
        </tr>  
      `;
        });
      } else if (reportType === 'shilixinxi') {
        tableHTML += `  
      <thead>  
        <tr>  
          <th>ç¼–å·</th>  
          <th>å§“å</th>  
          <th>æ€§åˆ«</th>
          <th>å‡ºç”Ÿå¹´æœˆ</th>  
          <th>å¹´é¾„</th>
          <th>èŒåŠ¡</th>            
          <th>å•ä½</th>  
          <th>å·¥ä½œå¹´é™</th>  
          <th>å¸½ç±»å·</th>
          <th>æœè£…å·</th>
          <th>é‹ç±»å·</th>
          <th>èº«é«˜</th>
          <th>èƒ¸å›´</th>          
          <th>è…°å›´</th>          
          <th>å¤´å›´</th>
          <th>å¯ç”¨ä½™é¢</th>
          <th>ç»è´¹æ¥æº</th>
          <th>å¤‡æ³¨</th>          
        </tr>  
      </thead>  
      <tbody>  
    `;

        report.forEach(item => {
          tableHTML += `  
        <tr>  
          <td>${item.number || ''}</td>  
          <td>${item.name || ''}</td>  
          <td>${item.gender || ''}</td>
          <td>${item.birthDate || ''}</td>        
          <td>${item.age || ''}</td>  
          <td>${item.position || ''}</td>  
          <td>${item.team || ''}</td>  
          <td>${item.year || ''}</td>
          <td>${item.maoleihao || ''}</td>  
          <td>${item.fuzhuanghao || ''}</td>  
          <td>${item.xieleihao || ''}</td>
          <td>${item.shengao || ''}</td>        
          <td>${item.xiongwei || ''}</td>  
          <td>${item.yaowei || ''}</td>  
          <td>${item.touwei || ''}</td>  
          <td>${item.keyongyue || ''}</td>
          <td>${item.jingfeilaiyuan || ''}</td>  
          <td>${item.remarks || ''}</td>                         
        </tr>  
      `;
        });
      }

      tableHTML += '</tbody></table>';
      return tableHTML;
    }


    // ä¸‹è½½PDFæŠ¥è¡¨  
    async function downloadReportPDF(report, reportType) {
      // åˆ›å»ºPDFæ–‡æ¡£  
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
    orientation: 'landscape', // è®¾ç½®ä¸ºæ¨ªå‘
    unit: 'mm',
    format: 'a4'
  });

     // è®¾ç½®è¡¨æ ¼çº¿å®½åº¦ä¸º 0.5mmï¼ˆé»˜è®¤é€šå¸¸æ˜¯ 0.1mm å·¦å³ï¼‰
     doc.setLineWidth(0.5);

      // åŠ è½½å­—ä½“  
      const fontPath = '/fonts/Simsun.ttf'; // ç¡®ä¿å­—ä½“æ–‡ä»¶è·¯å¾„æ­£ç¡®  
      const fontRes = await fetch(fontPath);
      if (!fontRes.ok) throw new Error('å­—ä½“æ–‡ä»¶æœªæ‰¾åˆ°');

      const fontBlob = await fontRes.arrayBuffer();

      // ä½¿ç”¨é€‚å½“çš„æ–¹æ³•è½¬æ¢ä¸º Base64 å­—ç¬¦ä¸²  
      const fontBase64 = arrayBufferToBase64(fontBlob); // è½¬æ¢ä¸º Base64 

      // æ·»åŠ å­—ä½“åˆ° jsPDF  
      doc.addFileToVFS('Simsun.ttf', fontBase64);
      doc.addFont('Simsun.ttf', 'Simsun', 'normal');
      doc.setFont('Simsun');


      // è®¾ç½®æ ‡é¢˜  
      const title = getReportTitle(reportType);
      doc.setFontSize(25);
      doc.text(title, 140, 15, { align: 'center' });

      // è®¾ç½®è¡¨æ ¼åˆ—  
      let columns = [];
      let rows = [];

      // æ ¹æ®ä¸åŒæŠ¥è¡¨ç±»å‹è®¾ç½®åˆ—  
      if (reportType === 'personnel') {
        columns = [
          { header: 'ç¼–å·', dataKey: 'number' },
          { header: 'å§“å', dataKey: 'name' },
          { header: 'æ€§åˆ«', dataKey: 'gender' },
          { header: 'å¹´é¾„', dataKey: 'age' },
          { header: 'èŒåŠ¡', dataKey: 'position' },
          { header: 'å•ä½', dataKey: 'team' },
          { header: 'å·¥ä½œå¹´é™', dataKey: 'year' },
          { header: 'å¯ç”¨ä½™é¢', dataKey: 'keyongyue' },
          { header: 'ç»è´¹æ¥æº', dataKey: 'jingfeilaiyuan' }
        ];
      } else if (reportType === 'equipment') {
        columns = [
          { header: 'ç¼–å·', dataKey: 'number' },
          { header: 'å§“å', dataKey: 'name' },
          { header: 'æ€§åˆ«', dataKey: 'gender' },
          { header: 'å•ä½', dataKey: 'team' },
          { header: 'å¸½ç±»å·', dataKey: 'maoleihao' },
          { header: 'æœè£…å·', dataKey: 'fuzhuanghao' },
          { header: 'é‹ç±»å·', dataKey: 'xieleihao' }
        ];
      } else if (reportType === 'bodySize') {
        columns = [
          { header: 'ç¼–å·', dataKey: 'number' },
          { header: 'å§“å', dataKey: 'name' },
          { header: 'æ€§åˆ«', dataKey: 'gender' },
          { header: 'å•ä½', dataKey: 'team' },
          { header: 'èº«é«˜(CM)', dataKey: 'shengao' },
          { header: 'èƒ¸å›´(CM)', dataKey: 'xiongwei' },
          { header: 'è…°å›´(CM)', dataKey: 'yaowei' },
          { header: 'å¤´å›´(CM)', dataKey: 'touwei' }
        ];
      } else if (reportType === 'teamSummary') {
        columns = [
          { header: 'å•ä½', dataKey: 'team' },
          { header: 'æ€»äººæ•°', dataKey: 'total' },
          { header: 'ç”·æ€§', dataKey: 'male' },
          { header: 'å¥³æ€§', dataKey: 'female' },
          { header: 'å¹³å‡å¹´é¾„', dataKey: 'avgAge' }
        ];
      } else if (reportType === 'changeHistory') {
        columns = [
          { header: 'ç¼–å·', dataKey: 'number' },
          { header: 'å§“å', dataKey: 'name' },
          { header: 'æ€§åˆ«', dataKey: 'gender' },
          { header: 'å¹´é¾„', dataKey: 'age' },
          { header: 'åŸå•ä½', dataKey: 'oldTeam' },
          { header: 'å˜æ›´å•ä½', dataKey: 'newTeam' },
          { header: 'å˜æ›´æ—¥æœŸ', dataKey: 'changeDate' }
        ];
      } else if (reportType === 'shilixinxi') {
        columns = [
          { header: 'ç¼–å·', dataKey: 'number' },
          { header: 'å§“å', dataKey: 'name' },
          { header: 'æ€§åˆ«', dataKey: 'gender' },
          { header: 'å‡ºç”Ÿå¹´æœˆ', dataKey: 'birthDate' },          
          { header: 'å¹´é¾„', dataKey: 'age' },
          { header: 'èŒåŠ¡', dataKey: 'position' },          
          { header: 'å•ä½', dataKey: 'team' },
          { header: 'å·¥ä½œå¹´é™', dataKey: 'year' },
          { header: 'å¸½ç±»å·', dataKey: 'maoleihao' },
          { header: 'æœè£…å·', dataKey: 'fuzhuanghao' },
          { header: 'é‹ç±»å·', dataKey: 'xieleihao' },
          { header: 'èº«é«˜', dataKey: 'shengao' },
          { header: 'èƒ¸å›´', dataKey: 'xiongwei' },
          { header: 'è…°å›´', dataKey: 'yaowei' },
          { header: 'å¤´å›´', dataKey: 'touwei' },
          { header: 'å¯ç”¨ä½™é¢', dataKey: 'keyongyue' },
          { header: 'ç»è´¹æ¥æº', dataKey: 'jingfeilaiyuan' },
          { header: 'å¤‡æ³¨', dataKey: 'remarks' }
        ];
      }

      // å°†æŠ¥è¡¨æ•°æ®è½¬æ¢ä¸ºè¡Œæ•°æ®  
      rows = report.map(item => {
        const row = {};
        columns.forEach(col => {
          // ä½¿ç”¨nullishåˆå¹¶è¿ç®—ç¬¦ (??)ï¼Œåªä¼šåœ¨å€¼ä¸ºnullæˆ–undefinedæ—¶ä½¿ç”¨åé¢çš„å€¼  
          row[col.dataKey] = item[col.dataKey] ?? '';
        });
        return row;
      });

      // ä¿å­˜ä¸Šæ¬¡è¡¨æ ¼ç»“æŸçš„ä½ç½®  
      let lastY = 0;

      // ç”ŸæˆPDFè¡¨æ ¼  
      doc.autoTable({
        startY: 20,
        head: [columns.map(col => col.header)],
        body: rows.map(row => columns.map(col => row[col.dataKey])),
        theme: 'grid',
        headStyles: {
          fillColor: [41, 128, 185],
          textColor: 255,
          fontSize: 8,
          halign: 'center'
        },
        margin: { top: 30 },
        styles: {
          font: "Simsun",
          fontSize: 8,
          cellPadding: 3,
          valign: 'middle',
          halign: 'center'
        },
        columnStyles: { text: { cellWidth: 'auto' } },
        didDrawPage: (data) => {
          // ä¿å­˜è¡¨æ ¼ç»“æŸä½ç½®  
          lastY = data.cursor.y;
        }
      });

      // æ·»åŠ é¡µè„š  
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        // ç¡®ä¿è®¾ç½®å­—ä½“åå†æ·»åŠ æ—¥æœŸæ–‡æœ¬  
        doc.setFont('Simsun');
        doc.setPage(i);
        doc.setFontSize(10);
        doc.text(`ç¬¬${i}é¡µ/å…±${pageCount}é¡µ`, 160, doc.internal.pageSize.height - 10, { align: 'center' });

        // åªåœ¨æœ€åä¸€é¡µçš„è¡¨æ ¼ä¸‹æ–¹æ·»åŠ æ—¥æœŸå’Œæ‰“å°äººä¿¡æ¯  
        if (i === pageCount) {
          // ç¡®ä¿è®¾ç½®å­—ä½“  
          doc.setFont('Simsun');
          doc.setFontSize(10);

          // åœ¨è¡¨æ ¼ä¸‹æ–¹æ·»åŠ æ—¥æœŸå’Œæ‰“å°äººä¿¡æ¯  
          const footerY = lastY + 15; // è¡¨æ ¼ç»“æŸä½ç½®ä¸‹æ–¹15mm  

          // å·¦ä¾§æ·»åŠ æ‰“å°æ—¥æœŸ  
          doc.text(`æ‰“å°æ—¥æœŸ:${new Date().toLocaleDateString()}`, 15, footerY);


          // ä» EJS å˜é‡ä¸­è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·å  
          const username = currentUser.username; // å‡è®¾å·²ä»åç«¯ä¼ é€’åˆ°å…¨å±€å˜é‡

          // è°ƒç”¨ç”Ÿæˆå‡½æ•°å¹¶åœ¨å®Œæˆåè¾“å‡ºPDF  
          generatePDF(doc, username, footerY).then(finalDoc => {
            // ä¸‹è½½PDF  
            finalDoc.save(`${title}-${new Date().toISOString().split('T')[0]}.pdf`);
          }).catch(error => {
            console.error('PDFç”Ÿæˆè¿‡ç¨‹ä¸­å‡ºé”™:', error);
          });
        }

      }
    }


    function generatePDF(doc, username, footerY) {
      return new Promise((resolve, reject) => {
        // å·¦ä¾§æ·»åŠ æ‰“å°æ—¥æœŸ  
        doc.text(`æ‰“å°æ—¥æœŸ:${new Date().toLocaleDateString()}`, 15, footerY);

        fetch(`/gerenxinxiguanli/fetch?number=${username}`)
          .then(res => res.json())
          .then(result => {
            if (result.success && result.data && result.data.name) {
              // å³ä¾§æ·»åŠ æ‰“å°äºº  
              doc.text(`æ‰“å°äºº:${result.data.name}`, 50, footerY);
            } else {
              // å¦‚æœæ²¡æœ‰è·å–åˆ°åå­—ï¼Œä½¿ç”¨é»˜è®¤åç§°  
              doc.text(`æ‰“å°äºº:ç³»ç»Ÿç®¡ç†å‘˜`, 50, footerY);
            }
            resolve(doc); // è¿”å›ä¿®æ”¹åçš„docå¯¹è±¡  
          })
          .catch(err => {
            console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', err);
            // å‡ºé”™æ—¶ä¹Ÿæ·»åŠ é»˜è®¤æ‰“å°äºº  
            doc.text(`æ‰“å°äºº:ç³»ç»Ÿç®¡ç†å‘˜`, 50, footerY);
            resolve(doc); // å°½ç®¡æœ‰é”™è¯¯ï¼Œä»ç„¶è¿”å›docå¯¹è±¡  
          });
      });
    }


    // æä¾›è½¬æ¢ ArrayBuffer ä¸º Base64 å­—ç¬¦ä¸²çš„æ–¹æ³•  
    function arrayBufferToBase64(buffer) {
      let binary = '';
      const bytes = new Uint8Array(buffer);
      const len = bytes.byteLength;
      for (let i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return window.btoa(binary); // ä½¿ç”¨ window.btoa å°†å­—ç¬¦ä¸²è½¬ä¸º Base64  
    }


    // ä¸‹è½½ExcelæŠ¥è¡¨  
    function downloadReportExcel(report, reportType) {
      // è®¾ç½®è¡¨æ ¼æ ‡é¢˜è¡Œ  
      let headers = [];
      const title = getReportTitle(reportType);

      // æ ¹æ®ä¸åŒæŠ¥è¡¨ç±»å‹è®¾ç½®åˆ—  
      if (reportType === 'personnel') {
        headers = ['ç¼–å·', 'å§“å', 'æ€§åˆ«', 'å¹´é¾„', 'èŒåŠ¡', 'å•ä½', 'å·¥ä½œå¹´é™', 'å¯ç”¨ä½™é¢', 'ç»è´¹æ¥æº', 'å¤‡æ³¨'];
      } else if (reportType === 'equipment') {
        headers = ['ç¼–å·', 'å§“å', 'æ€§åˆ«', 'å•ä½', 'å¸½ç±»å·', 'æœè£…å·', 'é‹ç±»å·'];
      } else if (reportType === 'bodySize') {
        headers = ['ç¼–å·', 'å§“å', 'æ€§åˆ«', 'å•ä½', 'èº«é«˜(CM)', 'èƒ¸å›´(CM)', 'è…°å›´(CM)', 'å¤´å›´(CM)'];
      } else if (reportType === 'teamSummary') {
        headers = ['å•ä½', 'æ€»äººæ•°', 'ç”·æ€§', 'å¥³æ€§', 'å¹³å‡å¹´é¾„'];
      } else if (reportType === 'changeHistory') {
        headers = ['ç¼–å·', 'å§“å', 'æ€§åˆ«', 'å¹´é¾„', 'åŸå•ä½', 'å˜æ›´å•ä½', 'å˜æ›´æ—¥æœŸ'];
      } else if (reportType === 'shilixinxi') {
        headers = ['ç¼–å·', 'å§“å', 'æ€§åˆ«', 'å‡ºç”Ÿå¹´æœˆ', 'å¹´é¾„', 'èŒåŠ¡', 'å•ä½', 'å·¥ä½œå¹´é™', 'å¸½ç±»å·', 'æœè£…å·', 'é‹ç±»å·', 'èº«é«˜', 'èƒ¸å›´', 'è…°å›´', 'å¤´å›´', 'å¯ç”¨ä½™é¢', 'ç»è´¹æ¥æº', 'å¤‡æ³¨'];
      }


      // å‡†å¤‡æ•°æ®è¡Œï¼Œæ·»åŠ æ ‡é¢˜è¡Œ  
      const rows = [];

      // æ·»åŠ æ ‡é¢˜è¡Œï¼ˆç¬¬ä¸€è¡Œï¼Œåé¢ä¼šåˆå¹¶å•å…ƒæ ¼ï¼‰  
      rows.push([title]);

      // ç¬¬äºŒè¡Œæ·»åŠ è¡¨å¤´  
      rows.push(headers);

      // æ ¹æ®ä¸åŒæŠ¥è¡¨ç±»å‹ç”Ÿæˆæ•°æ®è¡Œ  
      if (reportType === 'personnel') {
        report.forEach(item => {
          rows.push([
            item.number || '',
            item.name || '',
            item.gender || '',
            item.age || '',
            item.position || '',
            item.team || '',
            item.year || '',
            item.keyongyue || '',
            item.jingfeilaiyuan || '',
            item.remarks || ''
          ]);
        });
      } else if (reportType === 'equipment') {
        report.forEach(item => {
          rows.push([
            item.number || '',
            item.name || '',
            item.gender || '',
            item.team || '',
            item.maoleihao || '',
            item.fuzhuanghao || '',
            item.xieleihao || ''
          ]);
        });
      } else if (reportType === 'bodySize') {
        report.forEach(item => {
          rows.push([
            item.number || '',
            item.name || '',
            item.gender || '',
            item.team || '',
            item.shengao || '',
            item.xiongwei || '',
            item.yaowei || '',
            item.touwei || ''
          ]);
        });
      } else if (reportType === 'teamSummary') {
        report.forEach(item => {
          rows.push([
            item.team || '',
            item.total || 0,
            item.male || 0,
            item.female || 0,
            item.avgAge || 0
          ]);
        });
      } else if (reportType === 'changeHistory') {
        report.forEach(item => {
          rows.push([
            item.number || '',
            item.name || '',
            item.gender || '',
            item.age || '',
            item.oldTeam || '',
            item.newTeam || '',
            item.changeDate || ''
          ]);
        });
      } else if (reportType === 'shilixinxi') {
        report.forEach(item => {
          rows.push([
          item.number || '',  
          item.name || '', 
          item.gender || '',
          item.birthDate || '',        
          item.age || '',  
          item.position || '',  
          item.team || '',  
          item.year || '',
          item.maoleihao || '',  
          item.fuzhuanghao || '',  
          item.xieleihao || '',
          item.shengao || '',        
          item.xiongwei || '',  
          item.yaowei || '',  
          item.touwei || '',  
          item.keyongyue || '',
          item.jingfeilaiyuan || '',  
          item.remarks || '' 
          ]);
        });
      }

      // æ·»åŠ ç©ºè¡Œ  
      rows.push([]);

      // ä¸ºæœ€åä¸€è¡Œçš„æ¯ä¸ªå•å…ƒæ ¼å¡«å……ç©ºå€¼ä»¥ä¿è¯æ‰€æœ‰åˆ—éƒ½å­˜åœ¨  
      const printInfoRow = [];
      for (let i = 0; i < headers.length; i++) {
        printInfoRow.push('');
      }

      // è®¾ç½®æ‰“å°æ—¥æœŸå’Œæ‰“å°äººä¿¡æ¯  
      printInfoRow[0] = `æ‰“å°æ—¥æœŸ:${new Date().toLocaleDateString()}`;
      rows.push(printInfoRow);

      // è·å–æ‰“å°äººä¿¡æ¯ - ä½¿ç”¨Promise  
      const username = currentUser.username; // å‡è®¾å·²ä»åç«¯ä¼ é€’åˆ°å…¨å±€å˜é‡  

      // ä½¿ç”¨fetchè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶åœ¨å›è°ƒä¸­å¤„ç†ç”ŸæˆExcel  
      fetch(`/gerenxinxiguanli/fetch?number=${username}`)
        .then(response => response.json())
        .then(result => {
          // è®¾ç½®æ‰“å°äººä¿¡æ¯ - ä½¿ç”¨ä¸­é—´ä½ç½®ä½œä¸ºèµ·å§‹ç‚¹  
          const halfLength = Math.floor(headers.length / 2);
          if (result.success && result.data && result.data.name) {
            rows[rows.length - 1][halfLength] = `æ‰“å°äºº:${result.data.name}`;
          } else {
            rows[rows.length - 1][halfLength] = `æ‰“å°äºº:ç³»ç»Ÿç®¡ç†å‘˜`;
          }

          // ç”ŸæˆExcelæ–‡ä»¶(åœ¨ç¡®ä¿è·å–åˆ°æ‰“å°äººä¿¡æ¯å)  
          generateAndDownloadExcel(rows, headers, title);
        })
        .catch(error => {
          console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
          // å‘ç”Ÿé”™è¯¯æ—¶è®¾ç½®é»˜è®¤æ‰“å°äºº  
          const halfLength = Math.floor(headers.length / 2);
          rows[rows.length - 1][halfLength] = `æ‰“å°äºº:ç³»ç»Ÿç®¡ç†å‘˜`;
          // é”™è¯¯æ—¶ä¹Ÿèƒ½ç”ŸæˆExcel  
          generateAndDownloadExcel(rows, headers, title);
        });


      // å°†Excelç”Ÿæˆå’Œä¸‹è½½é€»è¾‘ç§»åˆ°å•ç‹¬çš„å‡½æ•°  
      function generateAndDownloadExcel(rows, headers, title) {

        // åˆ›å»ºå·¥ä½œè¡¨  
        const ws = XLSX.utils.aoa_to_sheet(rows);
        // è®¾ç½®åˆå¹¶å•å…ƒæ ¼ - å°†æ ‡é¢˜è¡Œåˆå¹¶  
        // åˆå¹¶åŒºåŸŸæ ¼å¼ä¸º {s: {c: èµ·å§‹åˆ—, r: èµ·å§‹è¡Œ}, e: {c: ç»“æŸåˆ—, r: ç»“æŸè¡Œ}}  
        const merge = {
          s: { c: 0, r: 0 }, // èµ·å§‹ä½ç½®ï¼šç¬¬1è¡Œï¼Œç¬¬1åˆ—  
          e: { c: headers.length - 1, r: 0 } // ç»“æŸä½ç½®ï¼šç¬¬1è¡Œï¼Œæœ€åä¸€åˆ—  
        };

        // å¦‚æœæ²¡æœ‰åˆå¹¶å•å…ƒæ ¼æ•°ç»„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª  
        if (!ws['!merges']) ws['!merges'] = [];

        // æ·»åŠ åˆå¹¶åŒºåŸŸ  
        ws['!merges'].push(merge);

        // ç¡®å®šæ‰“å°ä¿¡æ¯è¡Œçš„è¡Œå·  
        const printInfoRow = rows.length - 1;

        // è®¡ç®—ä¸­é—´ä½ç½®  
        const halfLength = Math.floor(headers.length / 2);

        // è®¾ç½®æ‰“å°æ—¥æœŸçš„åˆå¹¶å•å…ƒæ ¼ï¼ˆå·¦åŠéƒ¨åˆ†ï¼‰  
        const dateMerge = {
          s: { c: 0, r: printInfoRow }, // èµ·å§‹ä½ç½®ï¼šæœ€åä¸€è¡Œï¼Œç¬¬1åˆ—  
          e: { c: halfLength - 1, r: printInfoRow } // ç»“æŸä½ç½®ï¼šæœ€åä¸€è¡Œï¼Œä¸­é—´ä½ç½®-1  
        };
        ws['!merges'].push(dateMerge);

        // è®¾ç½®æ‰“å°äººçš„åˆå¹¶å•å…ƒæ ¼ï¼ˆå³åŠéƒ¨åˆ†ï¼‰  
        const userMerge = {
          s: { c: halfLength, r: printInfoRow }, // èµ·å§‹ä½ç½®ï¼šæœ€åä¸€è¡Œï¼Œä¸­é—´ä½ç½®  
          e: { c: headers.length - 1, r: printInfoRow } // ç»“æŸä½ç½®ï¼šæœ€åä¸€è¡Œï¼Œæœ€åä¸€åˆ—  
        };
        ws['!merges'].push(userMerge);

        // === æ ¹æ®æ¯åˆ—å†…å®¹è‡ªåŠ¨è°ƒæ•´åˆ—å®½ ===  
        // åˆå§‹åŒ–åˆ—å®½æ•°ç»„ï¼Œæ¯åˆ—è‡³å°‘æœ‰ä¸€ä¸ªæœ€å°å®½åº¦  
        const colWidths = Array(headers.length).fill().map(() => ({ wch: 8 }));

        // é¦–å…ˆè€ƒè™‘è¡¨å¤´çš„å®½åº¦  
        headers.forEach((header, idx) => {
          const headerWidth = getStringWidth(header);
          colWidths[idx].wch = headerWidth;
        });

        // éå†æ¯ä¸€è¡Œæ•°æ®ï¼Œæ‰¾å‡ºæ¯åˆ—ä¸­æœ€å®½çš„å†…å®¹  
        for (let r = 2; r < rows.length - 1; r++) {  // ä»æ•°æ®è¡Œå¼€å§‹ï¼Œè·³è¿‡æ ‡é¢˜å’Œè¡¨å¤´  
          for (let c = 0; c < headers.length; c++) {
            if (rows[r][c] !== undefined && rows[r][c] !== null) {
              // è·å–å†…å®¹å®½åº¦  
              const cellWidth = getStringWidth(rows[r][c].toString());
              // æ›´æ–°åˆ—å®½ï¼Œåªæœ‰å½“å†…å®¹å®½åº¦å¤§äºå½“å‰åˆ—å®½æ—¶æ‰æ›´æ–°  
              if (cellWidth > colWidths[c].wch) {
                colWidths[c].wch = cellWidth;
              }
            }
          }
        }

        // æ£€æŸ¥æ‰“å°ä¿¡æ¯è¡Œçš„å®½åº¦éœ€æ±‚  
        const printDateText = rows[printInfoRow][0] || '';
        const printUserText = rows[printInfoRow][halfLength] || '';

        // å·¦åŠè¾¹ï¼ˆæ‰“å°æ—¥æœŸï¼‰éœ€è¦çš„æ€»å®½åº¦  
        const dateInfoWidth = getStringWidth(printDateText);
        // å³åŠè¾¹ï¼ˆæ‰“å°äººï¼‰éœ€è¦çš„æ€»å®½åº¦  
        const userInfoWidth = getStringWidth(printUserText);

        // è®¡ç®—å½“å‰å·¦åŠè¾¹åˆ—çš„æ€»å®½åº¦  
        let leftTotalWidth = 0;
        for (let i = 0; i < halfLength; i++) {
          leftTotalWidth += colWidths[i].wch;
        }

        // è®¡ç®—å½“å‰å³åŠè¾¹åˆ—çš„æ€»å®½åº¦  
        let rightTotalWidth = 0;
        for (let i = halfLength; i < headers.length; i++) {
          rightTotalWidth += colWidths[i].wch;
        }

        // å¦‚æœæ‰“å°æ—¥æœŸéœ€è¦æ›´å¤šç©ºé—´ï¼Œé€‚å½“è°ƒæ•´å·¦åŠéƒ¨åˆ†çš„åˆ—å®½  
        if (dateInfoWidth > leftTotalWidth && halfLength > 0) {
          const extraWidthPerCol = Math.ceil((dateInfoWidth - leftTotalWidth) / halfLength);
          for (let i = 0; i < halfLength; i++) {
            colWidths[i].wch += extraWidthPerCol;
          }
        }

        // å¦‚æœæ‰“å°äººéœ€è¦æ›´å¤šç©ºé—´ï¼Œé€‚å½“è°ƒæ•´å³åŠéƒ¨åˆ†çš„åˆ—å®½  
        if (userInfoWidth > rightTotalWidth && (headers.length - halfLength > 0)) {
          const extraWidthPerCol = Math.ceil((userInfoWidth - rightTotalWidth) / (headers.length - halfLength));
          for (let i = halfLength; i < headers.length; i++) {
            colWidths[i].wch += extraWidthPerCol;
          }
        }

        // ä¸ºæ‰€æœ‰åˆ—å¢åŠ ä¸€äº›è¾¹è·  
        colWidths.forEach((col) => {
          col.wch += 4; // å¢åŠ 4ä¸ªå­—ç¬¦çš„è¾¹è·ï¼ˆå·¦å³å„2ä¸ªï¼‰  
        });

        // è®¾ç½®æœ€ç»ˆçš„åˆ—å®½  
        ws['!cols'] = colWidths;

        // è®¾ç½®æ ‡é¢˜å•å…ƒæ ¼æ ·å¼  
        // è¯¦ç»†çš„æ ·å¼å®šä¹‰  
        const styles = {
          title: {
            font: {
              name: 'å®‹ä½“',
              sz: 16,
              color: { rgb: "FFFFFF" },
              bold: true
            },
            fill: {
              fgColor: { rgb: "0070C0" }
            },
            alignment: {
              horizontal: "center",
              vertical: "center"
            }
            // ç§»é™¤äº†è¾¹æ¡†æ ·å¼  
          },
          header: {
            font: {
              name: 'å®‹ä½“',
              sz: 12,
              bold: true
            },
            fill: {
              fgColor: { rgb: "DDDDDD" }
            },
            alignment: {
              horizontal: "center",
              vertical: "center"
            },
            border: {
              top: { style: "thin", color: { rgb: "000000" } },
              bottom: { style: "thin", color: { rgb: "000000" } },
              left: { style: "thin", color: { rgb: "000000" } },
              right: { style: "thin", color: { rgb: "000000" } }
            }
          },
          cell: {
            alignment: {
              horizontal: "center",
              vertical: "center"
            },
            border: {
              top: { style: "thin", color: { rgb: "000000" } },
              bottom: { style: "thin", color: { rgb: "000000" } },
              left: { style: "thin", color: { rgb: "000000" } },
              right: { style: "thin", color: { rgb: "000000" } }
            }
          },
          footerInfo: {
            font: {
              name: 'å®‹ä½“',
              sz: 10,
              bold: true
            },
            alignment: {
              horizontal: "left",
              vertical: "center"
            }
          }
        };

        // åº”ç”¨æ ·å¼åˆ°å•å…ƒæ ¼  
        ws['A1'].s = styles.title;
        // ä¸ºè¡¨å¤´è¡Œï¼ˆç¬¬2è¡Œï¼‰çš„æ¯ä¸€åˆ—è®¾ç½®æ ·å¼  
        for (let i = 0; i < headers.length; i++) {
          // å°†åˆ—ç´¢å¼•è½¬æ¢ä¸ºExcelåˆ—æ ‡è¯† (A2, B2, C2...)  
          const cellRef = XLSX.utils.encode_cell({ c: i, r: 1 }); // r=1 æ˜¯ç¬¬äºŒè¡Œ
          // ç¡®ä¿å•å…ƒæ ¼å­˜åœ¨  
          if (!ws[cellRef]) ws[cellRef] = {};
          if (!ws[cellRef].s) ws[cellRef].s = {};
          ws[cellRef].s = styles.header;
        }

        // ä¸ºæ•°æ®è¡Œåº”ç”¨æ ·å¼  
        for (let row = 3; row < rows.length + 2; row++) {
          for (let col = 0; col < headers.length; col++) {
            const cellAddress = XLSX.utils.encode_cell({ r: row - 1, c: col });
            if (ws[cellAddress]) {
              ws[cellAddress].s = styles.cell;
            }
          }
        }

        // ä¸ºæ‰“å°ä¿¡æ¯è¡Œçš„æ‰€æœ‰å•å…ƒæ ¼åº”ç”¨æ— è¾¹æ¡†æ ·å¼  
        for (let col = 0; col < headers.length; col++) {
          const cellAddress = XLSX.utils.encode_cell({ r: printInfoRow, c: col });
          if (!ws[cellAddress]) ws[cellAddress] = { v: "" };
          ws[cellAddress].s = styles.footerInfo;
        }


        // åˆ›å»ºå·¥ä½œç°¿  
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, title);

        // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½  
        const fileName = `${title}-${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);
      }
    }


    // === æ·»åŠ ä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥è®¡ç®—å­—ç¬¦ä¸²å®½åº¦ ===  
    function getStringWidth(str) {
      if (!str) return 0;
      let width = 0;
      for (let i = 0; i < str.length; i++) {
        // ä¸­æ–‡å­—ç¬¦å’Œå…¨è§’ç¬¦å·å ç”¨æ›´å¤šå®½åº¦  
        if (str.charCodeAt(i) > 127) {
          width += 2.2;  // ä¸­æ–‡å­—ç¬¦å®½åº¦ç³»æ•°  
        } else {
          width += 1.1;  // è‹±æ–‡å­—ç¬¦å®½åº¦ç³»æ•°  
        }
      }
      // æ·»åŠ ä¸€äº›å†…è¾¹è·  
      return Math.ceil(width) + 2;
    }

  </script>
</body>

</html>